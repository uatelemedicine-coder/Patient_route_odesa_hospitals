<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø—Ä–æ–º–æ–∂–Ω–∞ –º–µ—Ä–µ–∂–∞ –ó–û–ó ‚Ä¢ –ú–∞—Ä—à—Ä—É—Ç–∏ –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤ ‚Ä¢ –û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        :root {
            --bg-primary: #f1f5f9;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e2e8f0;
            --bg-hover: #cbd5e1;
            --border-color: #cbd5e1;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --accent-purple: #9333ea;
            --accent-purple-bg: rgba(147, 51, 234, 0.12);
            --accent-blue: #2563eb;
            --accent-blue-bg: rgba(37, 99, 235, 0.12);
            --accent-gray: #475569;
            --accent-gray-bg: rgba(71, 85, 105, 0.12);
            --accent-green: #059669;
            --accent-orange: #ea580c;
            --accent-red: #dc2626;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); }
        
        .dashboard { display: flex; flex-direction: column; height: 100vh; }
        
        /* Header */
        /* Header - –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π */
        .header {
            background: #ffffff;
            padding: 10px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .header-left { display: flex; align-items: center; gap: 12px; }
        
        .logo {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 800; font-size: 12px;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }
        
        .header h1 { font-size: 16px; font-weight: 700; }
        .header-subtitle { font-size: 11px; color: var(--text-muted); margin-top: 1px; }
        
        /* View Switcher - –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π */
        .view-switcher {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 4px;
            gap: 4px;
            border: 1px solid var(--border-color);
        }
        
        .view-switcher-label {
            display: flex;
            align-items: center;
            padding: 0 10px;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .view-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 6px;
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .view-btn:hover { 
            background: var(--bg-hover); 
            color: var(--text-primary);
        }
        
        .view-btn.active {
            background: white;
            color: var(--text-primary);
            border-color: var(--accent-blue);
            box-shadow: 0 1px 4px rgba(37, 99, 235, 0.15);
        }
        
        .view-btn-icon {
            font-size: 14px;
        }
        
        .view-btn svg { width: 16px; height: 16px; }
        
        /* Stats Bar */
        .stats-bar {
            background: var(--bg-secondary);
            padding: 8px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .stat-network {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            padding: 6px 12px;
            border-radius: 8px;
            min-width: 100px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .stat-network:hover { transform: translateY(-1px); }
        
        .stat-network.nadklusterna {
            background: var(--accent-purple-bg);
            border: 2px solid rgba(147, 51, 234, 0.3);
        }
        .stat-network.klusterna {
            background: var(--accent-blue-bg);
            border: 2px solid rgba(37, 99, 235, 0.3);
        }
        .stat-network.zagalna {
            background: var(--accent-gray-bg);
            border: 2px solid rgba(71, 85, 105, 0.3);
        }
        
        /* –ê–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω —Ñ—ñ–ª—å—Ç—Ä—É - –í–ò–†–ê–ó–ù–ò–ô */
        .stat-network.active {
            transform: scale(1.05);
            position: relative;
        }
        .stat-network.active::before {
            content: '‚úì –§–Ü–õ–¨–¢–†';
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent-green);
            color: white;
            font-size: 8px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .stat-network.nadklusterna.active {
            border-color: var(--accent-purple);
            border-width: 3px;
            box-shadow: 0 4px 12px rgba(147, 51, 234, 0.4);
        }
        .stat-network.klusterna.active {
            border-color: var(--accent-blue);
            border-width: 3px;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }
        .stat-network.zagalna.active {
            border-color: var(--accent-gray);
            border-width: 3px;
            box-shadow: 0 4px 12px rgba(71, 85, 105, 0.4);
        }
        
        .stat-network-icon { font-size: 18px; }
        .stat-network-name { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px; }
        .stat-network-name.purple { color: var(--accent-purple); }
        .stat-network-name.blue { color: var(--accent-blue); }
        .stat-network-name.gray { color: var(--accent-gray); }
        .stat-network-count { font-size: 20px; font-weight: 800; }
        .stat-network-desc { font-size: 8px; color: var(--text-muted); text-align: center; }
        
        .stat-divider { width: 1px; height: 40px; background: var(--border-color); }
        
        .route-legend {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }
        
        .route-legend-title { font-size: 9px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; }
        
        .route-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
        }
        
        .route-line {
            width: 40px;
            height: 4px;
            border-radius: 2px;
        }
        
        .route-line.urgent { background: var(--accent-orange); }
        .route-line.complex { background: var(--accent-red); }
        .route-line.primary { background: var(--accent-green); }
        
        /* Main Content */
        .main-content { display: flex; flex: 1; overflow: hidden; }
        .map-container { flex: 1; position: relative; }
        #map { width: 100%; height: 100%; background: #e8ecf0; }
        
        /* Legend */
        .legend {
            position: absolute;
            bottom: 30px;
            left: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            font-size: 12px;
            z-index: 1000;
            min-width: 220px;
        }
        
        .legend-title {
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            font-size: 10px;
            margin-bottom: 12px;
            letter-spacing: 1px;
        }
        
        .legend-section { margin-bottom: 14px; }
        .legend-section:last-child { margin-bottom: 0; }
        .legend-section-title { font-size: 10px; color: var(--text-muted); margin-bottom: 8px; font-weight: 600; }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .legend-marker {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .legend-marker.nadklusterna { background: var(--accent-purple); color: white; }
        .legend-marker.klusterna { background: var(--accent-blue); color: white; }
        .legend-marker.zagalna { background: var(--accent-gray); color: white; }
        
        /* Info Panel */
        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 360px;
            transition: all 0.3s;
        }
        
        .info-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .info-panel-title { font-size: 16px; font-weight: 700; }
        .info-panel-subtitle { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
        
        .info-panel-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            margin-top: 8px;
        }
        
        .info-panel-badge.green { background: rgba(5, 150, 105, 0.15); color: #059669; }
        .info-panel-badge.orange { background: rgba(234, 88, 12, 0.15); color: #ea580c; }
        .info-panel-badge.red { background: rgba(220, 38, 38, 0.15); color: #dc2626; }
        .info-panel-badge.emergency { background: rgba(220, 38, 38, 0.2); color: #dc2626; border: 1px solid #dc2626; }
        
        .info-panel-content { font-size: 13px; line-height: 1.6; color: var(--text-secondary); }
        
        .info-panel-content h4 {
            color: var(--text-primary);
            font-size: 13px;
            margin: 12px 0 6px;
        }
        
        .info-panel-content ul {
            margin-left: 16px;
            margin-bottom: 8px;
        }
        
        /* Modal - —Å–ø–∏—Å–æ–∫ –ª—ñ–∫–∞—Ä–µ–Ω—å */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-overlay.show { display: flex; }
        
        .modal {
            background: var(--bg-secondary);
            border-radius: 16px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }
        
        .modal-title { font-size: 18px; font-weight: 700; }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-muted);
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        .modal-close:hover { background: var(--bg-hover); color: var(--text-primary); }
        
        .modal-body {
            padding: 16px 20px;
            overflow-y: auto;
            max-height: calc(80vh - 60px);
        }
        
        .modal-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .modal-tab {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-tab.nadklusterna { background: rgba(147, 51, 234, 0.1); color: #9333ea; }
        .modal-tab.klusterna { background: rgba(37, 99, 235, 0.1); color: #2563eb; }
        .modal-tab.zagalna { background: rgba(71, 85, 105, 0.1); color: #475569; }
        
        .modal-tab.active { box-shadow: 0 0 0 2px currentColor; }
        
        .facility-list { display: flex; flex-direction: column; gap: 8px; }
        
        .facility-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .facility-item:hover { border-color: var(--accent-blue); transform: translateX(4px); }
        
        .facility-icon {
            width: 36px; height: 36px;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px;
        }
        
        .facility-icon.nadklusterna { background: rgba(147, 51, 234, 0.15); }
        .facility-icon.klusterna { background: rgba(37, 99, 235, 0.15); }
        .facility-icon.zagalna { background: rgba(71, 85, 105, 0.15); }
        
        .facility-info { flex: 1; }
        .facility-name { font-size: 13px; font-weight: 600; margin-bottom: 2px; }
        .facility-district { font-size: 11px; color: var(--text-muted); }
        
        .facility-arrow { color: var(--text-muted); font-size: 16px; }
        
        /* –ö–Ω–æ–ø–∫–∞ —Å–ø–∏—Å–∫—É */
        .list-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .list-btn:hover { border-color: var(--accent-blue); box-shadow: 0 2px 8px rgba(37, 99, 235, 0.15); }
        
        /* Emergency button */
        .emergency-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
        }
        
        .emergency-btn:hover { 
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4); 
        }
        
        .emergency-btn.active {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.3);
        }
        
        .hidden { display: none !important; }
        
        /* Emergency submenu */
        .emergency-submenu {
            display: none;
            background: var(--bg-secondary);
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-color);
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .emergency-submenu.show { display: flex; }
        
        .emergency-submenu-label {
            font-size: 11px;
            font-weight: 700;
            color: #dc2626;
            text-transform: uppercase;
            margin-right: 8px;
        }
        
        .emergency-route-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border: 2px solid transparent;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .emergency-route-btn.all { background: rgba(220, 38, 38, 0.1); color: #dc2626; }
        .emergency-route-btn.stroke { background: rgba(124, 58, 237, 0.1); color: #7c3aed; }
        .emergency-route-btn.perinatal { background: rgba(8, 145, 178, 0.1); color: #0891b2; }
        .emergency-route-btn.ophthalm { background: rgba(5, 150, 105, 0.1); color: #059669; }
        .emergency-route-btn.general { background: rgba(234, 88, 12, 0.1); color: #ea580c; }
        
        .emergency-route-btn:hover { transform: translateY(-1px); }
        
        .emergency-route-btn.active {
            border-color: currentColor;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* Map labels */
        .map-label {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid;
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 11px;
            font-weight: 700;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .map-label.nadklusterna { border-color: #9333ea; color: #9333ea; }
        .map-label.klusterna { border-color: #2563eb; color: #2563eb; }
        .map-label.stroke { border-color: #7c3aed; color: #7c3aed; }
        .map-label.perinatal { border-color: #0891b2; color: #0891b2; }
        .map-label.ophthalm { border-color: #059669; color: #059669; }
        
        /* Contact labels */
        .map-label-contact {
            background: rgba(255, 255, 255, 0.98);
            border: 2px solid;
            border-radius: 10px;
            padding: 10px 14px;
            font-size: 11px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            min-width: 220px;
        }
        
        .map-label-contact.nadklusterna { border-color: #9333ea; }
        .map-label-contact.stroke { border-color: #7c3aed; }
        .map-label-contact.perinatal { border-color: #0891b2; }
        .map-label-contact.ophthalm { border-color: #059669; }
        
        .label-service {
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .map-label-contact.stroke .label-service { color: #7c3aed; }
        .map-label-contact.perinatal .label-service { color: #0891b2; }
        .map-label-contact.ophthalm .label-service { color: #059669; }
        .map-label-contact.nadklusterna .label-service { color: #9333ea; }
        
        .label-name { font-weight: 700; color: #1f2937; margin-bottom: 4px; }
        .label-chief { color: #4b5563; margin-bottom: 2px; }
        .label-phone { color: #059669; font-weight: 600; margin-bottom: 2px; }
        .label-coord { color: #6b7280; font-size: 10px; margin-bottom: 2px; }
        .label-add { color: #6b7280; font-size: 10px; }
        
        .map-label-wrapper { background: transparent !important; border: none !important; }
        
        .route-arrow-wrapper { background: transparent !important; border: none !important; }
        
        .arrow-with-distance {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }
        
        .arrow-icon {
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 0 3px white, 0 0 3px white, 0 0 5px white;
            display: inline-block;
        }
        
        .distance-label {
            font-size: 10px;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.95);
            padding: 1px 4px;
            border-radius: 3px;
            white-space: nowrap;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .small-label-wrapper { background: transparent !important; border: none !important; }
        
        .small-label {
            font-size: 9px;
            font-weight: 600;
            color: #374151;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 5px;
            border-radius: 3px;
            border-left: 2px solid;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 140px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        /* Arrow markers */
        .route-arrow {
            font-size: 14px;
            color: inherit;
        }
        
        /* Popup styles */
        .leaflet-popup-content-wrapper {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
        }
        
        .leaflet-popup-tip { background: var(--bg-secondary); }
        
        .leaflet-popup-content { margin: 0; min-width: 280px; }
        
        .popup-content { padding: 16px; }
        .popup-title { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
        .popup-subtitle { font-size: 11px; color: var(--text-muted); margin-bottom: 12px; }
        
        .popup-network {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 12px;
        }
        
        .popup-network.nadklusterna { background: var(--accent-purple-bg); color: var(--accent-purple); }
        .popup-network.klusterna { background: var(--accent-blue-bg); color: var(--accent-blue); }
        .popup-network.zagalna { background: var(--accent-gray-bg); color: var(--accent-gray); }
        
        .popup-routes { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color); }
        .popup-routes-title { font-size: 11px; color: var(--text-muted); margin-bottom: 8px; font-weight: 600; }
        
        .popup-route-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            margin-bottom: 6px;
            color: var(--text-secondary);
        }
        
        .popup-route-arrow { color: var(--accent-orange); font-weight: bold; }
        
        /* Controls */
        .map-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 1000;
        }
        
        .control-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 10px 14px;
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .control-btn:hover { background: var(--bg-tertiary); }
        .control-btn.active { background: var(--accent-blue); border-color: var(--accent-blue); }
        .control-btn svg { width: 16px; height: 16px; }
        
        /* Animation for routes */
        @keyframes flowAnimation {
            0% { stroke-dashoffset: 24; }
            100% { stroke-dashoffset: 0; }
        }
        
        .animated-route {
            animation: flowAnimation 1s linear infinite;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 14px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            font-size: 14px;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s;
        }
        
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        
        /* District labels */
        .district-label {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--accent-blue);
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        /* Facility labels */
        .facility-label {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }
        
        .facility-label.nadklusterna { border-left: 3px solid #9333ea; }
        .facility-label.klusterna { border-left: 3px solid #2563eb; }
        .facility-label.zagalna { border-left: 3px solid #475569; }
        
        /* Selected district highlight */
        .district-selected {
            fill-opacity: 0.3 !important;
            stroke-width: 3 !important;
        }
        
        .facility-label-wrapper, .district-label-wrapper {
            background: transparent !important;
            border: none !important;
        }
        
        /* Responsive */
        @media (max-width: 1000px) {
            .header { padding: 12px 16px; }
            .view-switcher { flex-wrap: wrap; }
            .view-btn span { display: none; }
            .stats-bar { overflow-x: auto; flex-wrap: nowrap; padding: 10px 16px; }
            .info-panel { max-width: 300px; }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <div class="header-left">
                <div class="logo">–°–ú</div>
                <div>
                    <h1>–°–ø—Ä–æ–º–æ–∂–Ω–∞ –º–µ—Ä–µ–∂–∞ –ó–û–ó</h1>
                    <div class="header-subtitle">–ú–∞—Ä—à—Ä—É—Ç–∏ –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤ ‚Ä¢ –û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</div>
                </div>
            </div>
            <div class="view-switcher">
                <div class="view-switcher-label">–†–µ–∂–∏–º:</div>
                <button class="view-btn active" data-view="1" onclick="setView(1)">
                    <span class="view-btn-icon">üü¢</span>
                    <span>–¶–ü–ú–°–î ‚Üí –ó–∞–≥–∞–ª—å–Ω—ñ</span>
                </button>
                <button class="view-btn" data-view="2" onclick="setView(2)">
                    <span class="view-btn-icon">üü†</span>
                    <span>–ó–∞–≥–∞–ª—å–Ω—ñ ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ</span>
                </button>
                <button class="view-btn" data-view="3" onclick="setView(3)">
                    <span class="view-btn-icon">üî¥</span>
                    <span>–ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ ‚Üí –ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ</span>
                </button>
            </div>
            <button class="emergency-btn" onclick="setView(4)">
                ‚ö†Ô∏è <span>–ï–∫—Å—Ç—Ä–µ–Ω–∏–π —Ä–µ–∂–∏–º</span>
            </button>
            <button class="list-btn" onclick="openFacilityList()">
                üìã <span>–°–ø–∏—Å–æ–∫ –ó–û–ó</span>
            </button>
        </div>
        
        <div class="stats-bar">
            <div class="stat-network nadklusterna" id="filter-nadk" onclick="filterByNetwork('–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞')">
                <div class="stat-network-icon">‚≠ê</div>
                <div class="stat-network-name purple">–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞</div>
                <div class="stat-network-count" id="stat-nadk">6</div>
                <div class="stat-network-desc">–í–∏—Å–æ–∫–æ—Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞</div>
            </div>
            <div class="stat-network klusterna" id="filter-klus" onclick="filterByNetwork('–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞')">
                <div class="stat-network-icon">üè•</div>
                <div class="stat-network-name blue">–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞</div>
                <div class="stat-network-count" id="stat-klus">13</div>
                <div class="stat-network-desc">–£—Ä–≥–µ–Ω—Ç–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞</div>
            </div>
            <div class="stat-network zagalna" id="filter-zag" onclick="filterByNetwork('–ó–∞–≥–∞–ª—å–Ω–∞')">
                <div class="stat-network-icon">üèõÔ∏è</div>
                <div class="stat-network-name gray">–ó–∞–≥–∞–ª—å–Ω–∞</div>
                <div class="stat-network-count" id="stat-zag">21</div>
                <div class="stat-network-desc">–í—Ç–æ—Ä–∏–Ω–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞</div>
            </div>
            
            <div class="stat-divider"></div>
            
            <div class="route-legend" id="route-legend">
                <div class="route-legend-title">–ú–∞—Ä—à—Ä—É—Ç–∏</div>
                <div class="route-legend-item">
                    <div style="width: 30px; height: 3px; background: #059669; border-radius: 2px;"></div>
                    <span>–¶–ü–ú–°–î ‚Üí –ó–∞–≥–∞–ª—å–Ω—ñ</span>
                </div>
                <div class="route-legend-item">
                    <div style="width: 30px; height: 3px; background: #ea580c; border-radius: 2px;"></div>
                    <span>–ó–∞–≥–∞–ª—å–Ω—ñ ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ</span>
                </div>
                <div class="route-legend-item">
                    <div style="width: 30px; height: 3px; background: #dc2626; border-radius: 2px;"></div>
                    <span>–ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ ‚Üí –ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ</span>
                </div>
            </div>
        </div>
        
        <!-- –ü—ñ–¥–º–µ–Ω—é –µ–∫—Å—Ç—Ä–µ–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É -->
        <div class="emergency-submenu" id="emergency-submenu">
            <span class="emergency-submenu-label">‚ö†Ô∏è –ú–∞—Ä—à—Ä—É—Ç–∏:</span>
            <button class="emergency-route-btn all active" data-route="all" onclick="setEmergencyRoute('all')">
                üìç –í—Å—ñ –º–∞—Ä—à—Ä—É—Ç–∏
            </button>
            <button class="emergency-route-btn general" data-route="general" onclick="setEmergencyRoute('general')">
                üü† –ó–∞–≥–∞–ª—å–Ω—ñ ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ
            </button>
            <button class="emergency-route-btn all" data-route="nadkluster" onclick="setEmergencyRoute('nadkluster')">
                üî¥ –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ ‚Üí –î—É–Ω–∞–π—Å—å–∫–∞
            </button>
            <button class="emergency-route-btn stroke" data-route="stroke" onclick="setEmergencyRoute('stroke')">
                üü£ –Ü–Ω—Å—É–ª—å—Ç / –Ü–Ω—Ñ–∞—Ä–∫—Ç
            </button>
            <button class="emergency-route-btn perinatal" data-route="perinatal" onclick="setEmergencyRoute('perinatal')">
                üîµ –ü–µ—Ä–∏–Ω–∞—Ç–∞–ª—å–Ω–∞
            </button>
            <button class="emergency-route-btn ophthalm" data-route="ophthalm" onclick="setEmergencyRoute('ophthalm')">
                üü¢ –û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥—ñ—è / –õ–û–†
            </button>
        </div>
        
        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
                
                <div class="map-controls">
                    <button class="control-btn active" id="toggle-districts" onclick="toggleDistricts()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        –†–∞–π–æ–Ω–∏
                    </button>
                    <button class="control-btn" onclick="fitMapToAll()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/>
                        </svg>
                        –í—Å—è –∫–∞—Ä—Ç–∞
                    </button>
                </div>
                
                <div class="legend">
                    <div class="legend-title">–õ–µ–≥–µ–Ω–¥–∞</div>
                    <div class="legend-section">
                        <div class="legend-section-title">–†—ñ–≤–Ω—ñ –º–µ—Ä–µ–∂—ñ</div>
                        <div class="legend-item">
                            <div class="legend-marker nadklusterna">‚≠ê</div>
                            <span>–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞ (–æ–±–ª–∞—Å–Ω—ñ)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-marker klusterna">üè®</div>
                            <span>–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞ (–æ–ø–æ—Ä–Ω—ñ)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-marker zagalna">üèõÔ∏è</div>
                            <span>–ó–∞–≥–∞–ª—å–Ω–∞ (–≤—Ç–æ—Ä–∏–Ω–Ω–∞)</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 12px; height: 12px; background: #10b981; border-radius: 50%; border: 2px solid #059669;"></div>
                            <span>–¶–ü–ú–°–î (–ø–µ—Ä–≤–∏–Ω–Ω–∞)</span>
                        </div>
                    </div>
                    <div class="legend-section" id="routes-legend">
                        <div class="legend-section-title">–ú–∞—Ä—à—Ä—É—Ç–∏</div>
                        <div class="legend-item">
                            <div style="width: 24px; height: 3px; background: #059669; border-radius: 2px;"></div>
                            <span>–¶–ü–ú–°–î ‚Üí –ó–∞–≥–∞–ª—å–Ω—ñ</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 24px; height: 3px; background: #ea580c; border-radius: 2px;"></div>
                            <span>–ó–∞–≥–∞–ª—å–Ω—ñ ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 24px; height: 3px; background: #dc2626; border-radius: 2px;"></div>
                            <span>–ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ ‚Üí –ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ</span>
                        </div>
                    </div>
                    <!-- –õ–µ–≥–µ–Ω–¥–∞ –¥–ª—è –µ–∫—Å—Ç—Ä–µ–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É (–ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º) -->
                    <div class="legend-section hidden" id="emergency-legend">
                        <div class="legend-section-title">‚ö†Ô∏è –ï–∫—Å—Ç—Ä–µ–Ω–∏–π —Ä–µ–∂–∏–º</div>
                        <div class="legend-item">
                            <div style="width: 24px; height: 3px; background: #ea580c; border-radius: 2px;"></div>
                            <span>–ó–∞–≥–∞–ª—å–Ω—ñ ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 24px; height: 3px; background: #dc2626; border-radius: 2px;"></div>
                            <span>–ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ ‚Üí –î—É–Ω–∞–π—Å—å–∫–∞</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 24px; height: 3px; background: #7c3aed; border-radius: 2px;"></div>
                            <span>–Ü–Ω—Å—É–ª—å—Ç / –Ü–Ω—Ñ–∞—Ä–∫—Ç</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 24px; height: 3px; background: #0891b2; border-radius: 2px;"></div>
                            <span>–ü–µ—Ä–∏–Ω–∞—Ç–∞–ª—å–Ω–∞ / –ù–µ–æ–Ω–∞—Ç–æ–ª–æ–≥—ñ—è</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 24px; height: 3px; background: #059669; border-radius: 2px;"></div>
                            <span>–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥—ñ—è / –õ–û–†</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-panel" id="info-panel">
                    <div class="info-panel-header">
                        <div>
                            <div class="info-panel-title" id="panel-title">–†–µ–∂–∏–º –ø–µ—Ä–µ–≥–ª—è–¥—É</div>
                            <div class="info-panel-subtitle" id="panel-subtitle">–û–±–µ—Ä—ñ—Ç—å —Ä–µ–∂–∏–º</div>
                            <div class="info-panel-badge green" id="panel-badge">–†–ï–ñ–ò–ú 1</div>
                        </div>
                    </div>
                    <div class="info-panel-content" id="panel-content">
                        –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ä–µ–∂–∏–º
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <!-- Modal: –°–ø–∏—Å–æ–∫ –ª—ñ–∫–∞—Ä–µ–Ω—å -->
    <div class="modal-overlay" id="facility-modal" onclick="closeFacilityList(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">üìã –ó–∞–∫–ª–∞–¥–∏ –æ—Ö–æ—Ä–æ–Ω–∏ –∑–¥–æ—Ä–æ–≤'—è</div>
                <button class="modal-close" onclick="closeFacilityList()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <button class="modal-tab nadklusterna active" onclick="showFacilityTab('–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞')">
                        ‚≠ê –ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ (<span id="count-nadk">0</span>)
                    </button>
                    <button class="modal-tab klusterna" onclick="showFacilityTab('–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞')">
                        üè• –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ (<span id="count-klus">0</span>)
                    </button>
                    <button class="modal-tab zagalna" onclick="showFacilityTab('–ó–∞–≥–∞–ª—å–Ω–∞')">
                        üèõÔ∏è –ó–∞–≥–∞–ª—å–Ω—ñ (<span id="count-zag">0</span>)
                    </button>
                </div>
                <div class="facility-list" id="facility-list"></div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ============ MAP INITIALIZATION ============
        const map = L.map('map', {
            zoomControl: false
        }).setView([46.5, 29.8], 7);
        
        L.control.zoom({ position: 'bottomright' }).addTo(map);
        
        // Light tile layer
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '¬© OpenStreetMap ¬© CARTO',
            maxZoom: 19
        }).addTo(map);
        
        // –°–∫–∏–¥–∞–Ω–Ω—è –≤–∏–±–æ—Ä—É —Ä–∞–π–æ–Ω—É –ø—Ä–∏ –ø–æ–¥–≤—ñ–π–Ω–æ–º—É –∫–ª—ñ–∫—É –Ω–∞ –∫–∞—Ä—Ç—ñ
        map.on('dblclick', () => {
            if (selectedDistrict) {
                resetDistrictSelection();
                map.setView([46.5, 29.8], 7);
            }
        });
        
        // ============ DATA ============
        const districtBoundaries = {"type":"FeatureCollection","features":[{"type":"Feature","properties":{"name":"–û–¥–µ—Å—å–∫–∏–π"},"geometry":{"type":"Polygon","coordinates":[[[30.0888,46.3773],[30.1685,46.3773],[30.1877,46.2615],[30.2975,46.2122],[30.4294,46.1094],[30.4843,46.077],[30.6052,46.1931],[30.6903,46.3014],[30.7343,46.3716],[30.7727,46.4473],[30.7562,46.5022],[30.759,46.5437],[30.7864,46.5607],[30.8249,46.5513],[30.9073,46.5664],[30.9842,46.5853],[31.0144,46.6136],[31.0583,46.6098],[31.127,46.6098],[31.16,46.6193],[31.1847,46.6758],[31.1765,46.753],[31.16,46.7869],[31.138,46.8226],[31.0968,46.8583],[31.0144,46.8527],[30.9512,46.8696],[30.8798,46.8827],[30.748,46.8677],[30.6628,46.8677],[30.6024,46.8527],[30.5035,46.817],[30.4541,46.8677],[30.4623,46.7869],[30.4074,46.7718],[30.2975,46.7624],[30.2481,46.753],[30.2097,46.7267],[30.1959,46.6871],[30.1355,46.6834],[30.0476,46.6758],[29.968,46.6683],[29.968,46.6079],[29.9515,46.574],[29.913,46.557],[29.9377,46.506],[30.0092,46.4965],[30.0037,46.4738],[30.0394,46.4549],[30.1053,46.4397],[30.1602,46.4227],[30.1108,46.4076],[30.0888,46.3773]]]}},{"type":"Feature","properties":{"name":"–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π"},"geometry":{"type":"Polygon","coordinates":[[[28.2349,45.4736],[28.298,45.5371],[28.3914,45.5217],[28.4244,45.4813],[28.5095,45.5025],[28.5864,45.4832],[28.5974,45.3425],[28.6578,45.3502],[28.6578,45.4832],[28.6935,45.5044],[28.7485,45.5698],[28.8583,45.616],[29.0067,45.6428],[29.0863,45.6947],[29.1632,45.71],[29.1467,45.614],[29.2319,45.7081],[29.3445,45.6928],[29.4351,45.6505],[29.4928,45.6294],[29.5944,45.5525],[29.6548,45.5083],[29.7537,45.5256],[29.7977,45.4332],[29.7949,45.3541],[29.7812,45.2517],[29.7867,45.2033],[29.7263,45.2033],[29.6741,45.2072],[29.6658,45.2807],[29.6384,45.3328],[29.5724,45.3849],[29.4928,45.4235],[29.3939,45.4409],[29.317,45.4332],[29.2538,45.4119],[29.2291,45.383],[29.1467,45.3849],[29.0836,45.3811],[29.0314,45.356],[28.9737,45.3309],[28.9462,45.3019],[28.9078,45.2942],[28.8501,45.3097],[28.7924,45.3232],[28.7567,45.3077],[28.754,45.2788],[28.7924,45.2575],[28.7567,45.2382],[28.7018,45.2285],[28.6523,45.2362],[28.5974,45.2459],[28.526,45.2594],[28.4683,45.2768],[28.3859,45.3155],[28.3145,45.3386],[28.2788,45.3714],[28.2596,45.4254],[28.2349,45.4736]]]}},{"type":"Feature","properties":{"name":"–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π"},"geometry":{"type":"Polygon","coordinates":[[[28.504,45.5025],[28.5837,45.4832],[28.6002,45.3406],[28.6688,45.3521],[28.6606,45.4871],[28.7018,45.5217],[28.765,45.5775],[28.8885,45.6275],[28.9984,45.6409],[29.0424,45.6678],[29.1412,45.7119],[29.155,45.6217],[29.2209,45.7119],[29.3088,45.7004],[29.3912,45.6697],[29.5203,45.7886],[29.534,45.869],[29.556,45.9397],[29.5697,46.0084],[29.5477,46.0904],[29.545,46.1912],[29.5944,46.2045],[29.5889,46.3128],[29.5862,46.3602],[29.5615,46.4114],[29.5038,46.4341],[29.4626,46.4889],[29.4269,46.4927],[29.3774,46.4568],[29.3582,46.4965],[29.3198,46.4606],[29.2703,46.4132],[29.2072,46.3791],[29.2264,46.4114],[29.2264,46.4416],[29.2072,46.4776],[29.2319,46.506],[29.2017,46.5513],[29.1605,46.5267],[29.0891,46.5154],[29.0204,46.5022],[28.9435,46.4473],[28.9819,46.3773],[28.9819,46.2976],[28.9764,46.2255],[29.0726,46.1836],[29.0121,46.1437],[28.9655,46.0828],[29.0314,46.0351],[28.9957,46.0065],[28.9215,45.9836],[28.7787,45.9626],[28.7759,45.8345],[28.6798,45.8097],[28.6853,45.7771],[28.6002,45.7637],[28.5974,45.7254],[28.5287,45.7292],[28.4793,45.7004],[28.4821,45.662],[28.537,45.6486],[28.548,45.6083],[28.5452,45.5852],[28.4958,45.5525],[28.504,45.5025]]]}},{"type":"Feature","properties":{"name":"–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π"},"geometry":{"type":"Polygon","coordinates":[[[29.3774,45.664],[29.545,45.5987],[29.5972,45.5371],[29.6439,45.5294],[29.8526,45.6601],[29.924,45.7004],[30.0751,45.8097],[30.2591,45.8996],[30.369,46.0427],[30.4349,46.0713],[30.3882,46.1285],[30.3333,46.1912],[30.2563,46.2255],[30.1849,46.2672],[30.1053,46.3299],[30.0888,46.3754],[29.9377,46.3886],[29.8856,46.3659],[29.8306,46.3867],[29.7867,46.417],[29.751,46.4662],[29.7098,46.4416],[29.6494,46.4246],[29.6576,46.3735],[29.5834,46.364],[29.5944,46.3033],[29.5972,46.2083],[29.5395,46.1817],[29.5615,46.0847],[29.567,46.0237],[29.5505,45.9607],[29.5532,45.8843],[29.5532,45.8154],[29.5148,45.7752],[29.4351,45.7081],[29.3774,45.664]]]}},{"type":"Feature","properties":{"name":"–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π"},"geometry":{"type":"Polygon","coordinates":[[[30.2618,47.9605],[30.2234,48.0028],[30.2563,48.0322],[30.2179,48.0652],[30.2783,48.0909],[30.3278,48.0946],[30.3278,48.1313],[30.2673,48.1478],[30.1602,48.1588],[30.108,48.1459],[30.0449,48.1624],[30.0092,48.2082],[29.9625,48.2393],[29.8801,48.199],[29.8004,48.21],[29.7043,48.1936],[29.6494,48.1789],[29.6384,48.1111],[29.5038,48.1019],[29.3555,48.1056],[29.2758,48.1056],[29.2017,48.1276],[29.1275,48.1551],[29.0588,48.1862],[29.0341,48.1404],[28.9819,48.1478],[28.9188,48.1239],[28.8556,48.0799],[28.8364,48.045],[28.8858,48.0083],[28.9133,47.9771],[28.9792,47.9715],[29.0506,47.9347],[29.0945,47.9715],[29.2264,47.9145],[29.2621,47.8592],[29.1962,47.8242],[29.2593,47.8039],[29.2538,47.7744],[29.2264,47.7393],[29.2236,47.6783],[29.2264,47.6321],[29.1879,47.5821],[29.1467,47.571],[29.1522,47.5302],[29.1989,47.5079],[29.1852,47.4615],[29.2209,47.4392],[29.2841,47.4374],[29.3335,47.4467],[29.35,47.3835],[29.3857,47.3574],[29.4269,47.309],[29.4736,47.3128],[29.5313,47.3574],[29.5752,47.3128],[29.6796,47.4448],[29.9323,47.4671],[29.9954,47.4541],[30.1108,47.4374],[30.1987,47.4615],[30.325,47.5153],[30.4623,47.5691],[30.4871,47.6173],[30.4459,47.6432],[30.4019,47.7098],[30.4047,47.7559],[30.4239,47.7947],[30.3278,47.8316],[30.303,47.8869],[30.2921,47.9237],[30.2618,47.9605]]]}},{"type":"Feature","properties":{"name":"–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∏–π"},"geometry":{"type":"Polygon","coordinates":[[[29.5862,47.3221],[29.6548,47.4355],[29.8938,47.456],[29.9789,47.4374],[30.097,47.4411],[30.1328,47.4058],[30.1245,47.337],[30.1245,47.2885],[30.163,47.2569],[30.2151,47.2084],[30.2563,47.1486],[30.2975,47.0888],[30.4047,47.0645],[30.4102,47.0158],[30.3992,46.9521],[30.4376,46.8959],[30.4541,46.8546],[30.4706,46.8019],[30.4376,46.7606],[30.2563,46.7624],[30.2206,46.7606],[30.2097,46.706],[30.2151,46.6852],[30.141,46.6834],[30.0806,46.6702],[30.0009,46.6834],[29.957,46.6871],[29.9542,46.7493],[29.9542,46.7869],[29.9487,46.8132],[29.9405,46.8489],[29.8746,46.8677],[29.8169,46.8884],[29.7592,46.8752],[29.7153,46.9052],[29.6466,46.9296],[29.5697,46.9503],[29.5862,46.984],[29.6494,47.0477],[29.5999,47.0982],[29.5532,47.1],[29.4955,47.1243],[29.5587,47.1449],[29.5422,47.2438],[29.5862,47.2643],[29.5862,47.3221]]]}},{"type":"Feature","properties":{"name":"–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π"},"geometry":{"type":"Polygon","coordinates":[[[30.1328,47.4374],[30.4623,47.5654],[30.5035,47.6284],[30.6244,47.6228],[30.7178,47.5969],[30.7507,47.6506],[30.7892,47.6117],[30.7864,47.571],[30.8524,47.5302],[30.8496,47.5079],[30.8551,47.4541],[30.8743,47.4169],[30.8936,47.3835],[30.9155,47.3239],[30.9018,47.2979],[30.9814,47.296],[31.0062,47.2643],[31.171,47.2513],[31.1682,47.2233],[31.1243,47.1617],[31.1847,47.1617],[31.2341,47.1598],[31.311,47.0813],[31.2918,47.0252],[31.2039,46.9877],[31.127,46.9803],[31.0007,46.9615],[31.0474,46.9015],[31.1243,46.8508],[30.9787,46.847],[30.8936,46.8865],[30.8414,46.8752],[30.7123,46.8696],[30.6381,46.8546],[30.5557,46.8283],[30.4926,46.832],[30.4156,46.9353],[30.4102,47.0458],[30.2921,47.1019],[30.141,47.2699],[30.13,47.337],[30.1328,47.3928],[30.1328,47.4374]]]}}]};
        
        // Facilities data from PDF
        const facilities = [
            // –ù–ê–î–ö–õ–ê–°–¢–ï–†–ù–Ü (–û–±–ª–∞—Å–Ω—ñ)
            { id: 1, name: '–ö–ù–ü "–û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å–Ω–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.581611, lng: 30.789912 },
            { id: 2, name: '–ö–ù–ü "–û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å–Ω–∞ –¥–∏—Ç—è—á–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.484114, lng: 30.692607 },
            { id: 5, name: '–ö–ù–ü "–û–¥–µ—Å—å–∫–∏–π –æ–±–ª–∞—Å–Ω–∏–π —Ü–µ–Ω—Ç—Ä —Å–æ—Ü—ñ–∞–ª—å–Ω–æ –∑–Ω–∞—á—É—â–∏—Ö —Ö–≤–æ—Ä–æ–±"', type: '–¶–µ–Ω—Ç—Ä', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.470734, lng: 30.753907 },
            { id: 6, name: '–ö–ù–ü "–û–¥–µ—Å—å–∫–∏–π –æ–±–ª–∞—Å–Ω–∏–π –º–µ–¥–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä –ø—Å–∏—Ö—ñ—á–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤\'—è"', type: '–¶–µ–Ω—Ç—Ä', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.492261, lng: 30.694628 },
            { id: 7, name: '–í–î "–î—É–Ω–∞–π—Å—å–∫–∞ —Ñ—ñ–ª—ñ—è" –ö–ù–ü "–û–û–ö–õ" –û–û–†', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π', network: '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 45.33523, lng: 28.85428 },
            { id: 10, name: '–ö–ù–ü "–û–¥–µ—Å—å–∫–∏–π —Ä–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–∏–π –∫–ª—ñ–Ω—ñ—á–Ω–∏–π –ø—Ä–æ—Ç–∏–ø—É—Ö–ª–∏–Ω–Ω–∏–π —Ü–µ–Ω—Ç—Ä"', type: '–¶–µ–Ω—Ç—Ä', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.496145, lng: 30.691552 },
            
            // –ö–õ–ê–°–¢–ï–†–ù–Ü (–û–ø–æ—Ä–Ω—ñ)
            { id: 17, name: '–ö–ù–ü "–ê—Ä—Ü–∏–∑—å–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –æ–ø–æ—Ä–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.007252, lng: 29.433459 },
            { id: 18, name: '–ö–ü "–ë–∞–ª—Ç—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 47.961505, lng: 29.617026 },
            { id: 19, name: '–ö–ù–ü "–ë—ñ–ª—è—ó–≤—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.482652, lng: 30.214531 },
            { id: 20, name: '–ö–ù–ü "–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –º—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 47.200460, lng: 30.897316 },
            { id: 21, name: '–ö–ù–ü "–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∞ –º—ñ—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.191405, lng: 30.345295 },
            { id: 22, name: '–ö–ù–ü "–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∞ –º—ñ—Å—å–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 45.352638, lng: 28.840026 },
            { id: 27, name: '–ö–ù–ü "–ü–æ–¥—ñ–ª—å—Å—å–∫–∞ –º—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 47.7495, lng: 29.5367 },
            { id: 28, name: '–ö–ù–ü "–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.860329, lng: 30.074253 },
            { id: 30, name: '–ö–ù–ü "–ß–æ—Ä–Ω–æ–º–æ—Ä—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.301126, lng: 30.637257 },
            { id: 31, name: '–ö–ù–ü "–ú—ñ—Å—å–∫–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è ‚Ññ 1"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.468866, lng: 30.725054 },
            { id: 34, name: '–ö–ù–ü "–ú—ñ—Å—å–∫–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è ‚Ññ 10"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.449157, lng: 30.745504 },
            { id: 35, name: '–ö–ù–ü "–ú—ñ—Å—å–∫–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è ‚Ññ 11"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.488170, lng: 30.694396 },
            { id: 52, name: '–ö–ù–ü "–î–∏—Ç—è—á–∞ –º—ñ—Å—å–∫–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è ‚Ññ 3"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞', lat: 46.380866, lng: 30.746349 },
            
            // –ó–ê–ì–ê–õ–¨–ù–Ü (–†–∞–π–æ–Ω–Ω—ñ)
            { id: 3, name: '–ö–ù–ü "–û–¥–µ—Å—å–∫–∏–π –æ–±–ª–∞—Å–Ω–∏–π –∫–ª—ñ–Ω—ñ—á–Ω–∏–π –º–µ–¥–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä"', type: '–¶–µ–Ω—Ç—Ä', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 46.433073, lng: 30.740721 },
            { id: 4, name: '–ö–ù–ü "–ë–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∏–π —à–ø–∏—Ç–∞–ª—å –≤–µ—Ç–µ—Ä–∞–Ω—ñ–≤"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 46.406162, lng: 30.756103 },
            { id: 16, name: '–ö–ù–ü "–ê–Ω–∞–Ω—å—ó–≤—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –º—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 47.723035, lng: 29.960607 },
            { id: 24, name: '–ö–ù–ü "–ö—ñ–ª—ñ–π—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 45.442, lng: 29.262 },
            { id: 25, name: '–ö–ù–ü "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –º—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è" –†–µ–Ω—ñ–π—Å—å–∫–∞', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 45.457001, lng: 28.270420 },
            { id: 26, name: '–ö–ù–ü "–ü—ñ–≤–¥–µ–Ω–Ω—ñ–≤—Å—å–∫–∞ –º—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 46.625089, lng: 31.092239 },
            { id: 29, name: '–ö–ù–ü "–¢–∞—Ç–∞—Ä–±—É–Ω–∞—Ä—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 45.833361, lng: 29.621752 },
            { id: 33, name: '–ö–ù–ü "–ú—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è ‚Ññ 8"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 46.396169, lng: 30.747948 },
            { id: 36, name: '–ö–ù–ü "–í–µ–ª–∏–∫–æ–º–∏—Ö–∞–π–ª—ñ–≤—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 47.096076, lng: 29.845187 },
            { id: 37, name: '–ö–ù–ü "–ó–∞—Ö–∞—Ä—ñ–≤—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 47.339551, lng: 29.755811 },
            { id: 38, name: '–ö–ù–ü "–î–æ–±—Ä–æ—Å–ª–∞–≤—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è —ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–≥–æ –ª—ñ–∫—É–≤–∞–Ω–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 46.828179, lng: 30.944036 },
            { id: 39, name: '–ö–ù–ü "–õ—é–±–∞—à—ñ–≤—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è —ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–≥–æ –ª—ñ–∫—É–≤–∞–Ω–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 47.841587, lng: 30.263518 },
            { id: 40, name: '–ö–ù–ü "–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ —Ä–∞–π–æ–Ω–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 45.680453, lng: 28.622383 },
            { id: 42, name: '–ö–ù–ü "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ —Ä–∞–π–æ–Ω–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è" –°–∞—Ñ\'—è–Ω—ñ–≤—Å—å–∫–∞', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 45.407265, lng: 28.875363 },
            { id: 43, name: '–ö–ù–ü "–ö–æ–¥–∏–º—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 48.097565, lng: 29.122824 },
            { id: 44, name: '–ö–ù–ü "–û–≤—ñ–¥—ñ–æ–ø–æ–ª—å—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–û–¥–µ—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 46.222410, lng: 30.434187 },
            { id: 47, name: '–ö–ü "–°–∞—Ä–∞—Ç—Å—å–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 46.023406, lng: 29.658579 },
            { id: 48, name: '–ö–ù–ü "–ë–µ—Å—Å–∞—Ä–∞–±—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 46.152, lng: 29.168 },
            { id: 49, name: '–ö–ù–ü "–®–∏—Ä—è—ó–≤—Å—å–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ —Ä–∞–π–æ–Ω–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è"', type: '–õ—ñ–∫–∞—Ä–Ω—è', district: '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 47.387834, lng: 30.191201 },
            { id: 51, name: '–ö–ù–ü "–Ü–≤–∞–Ω—ñ–≤—Å—å–∫–∏–π –º–µ–¥–∏—á–Ω–∏–π —Ü–µ–Ω—Ç—Ä"', type: '–¶–µ–Ω—Ç—Ä', district: '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π', network: '–ó–∞–≥–∞–ª—å–Ω–∞', lat: 46.980690, lng: 30.468498 }
        ];
        
        // ============ LAYERS ============
        let districtLayer = null;
        let markersLayer = L.layerGroup().addTo(map);
        let routesLayer = L.layerGroup();
        let labelsLayer = L.layerGroup().addTo(map);
        let mapLabelsLayer = L.layerGroup().addTo(map);
        let districtLabelLayer = null;
        let districtsVisible = true;
        let routesVisible = false;
        let currentView = 1;
        let currentFilter = null;
        let selectedDistrict = null;
        let currentEmergencyRoute = 'all';
        
        // ============ DISTRICT BOUNDARIES ============
        function createDistrictBoundaries() {
            if (districtLayer) map.removeLayer(districtLayer);
            
            districtLayer = L.geoJSON(districtBoundaries, {
                style: feature => ({
                    color: '#6366f1',
                    weight: 2,
                    opacity: 0.8,
                    fillColor: '#6366f1',
                    fillOpacity: 0.05,
                    dashArray: '5, 5'
                }),
                onEachFeature: (feature, layer) => {
                    layer.bindTooltip(feature.properties.name + ' —Ä–∞–π–æ–Ω', {
                        permanent: false,
                        direction: 'center',
                        className: 'district-tooltip'
                    });
                    
                    // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –Ω–∞ —Ä–∞–π–æ–Ω
                    layer.on('click', () => {
                        zoomToDistrict(feature.properties.name, layer);
                    });
                    
                    // Hover –µ—Ñ–µ–∫—Ç–∏
                    layer.on('mouseover', () => {
                        layer.setStyle({
                            fillOpacity: 0.15,
                            weight: 3
                        });
                    });
                    
                    layer.on('mouseout', () => {
                        if (selectedDistrict !== feature.properties.name) {
                            layer.setStyle({
                                fillOpacity: 0.05,
                                weight: 2
                            });
                        }
                    });
                }
            }).addTo(map);
        }
        
        // ============ ZOOM TO DISTRICT ============
        function zoomToDistrict(districtName, layer) {
            selectedDistrict = districtName;
            
            // –ó—É–º—É—î–º–æ –¥–æ –º–µ–∂ —Ä–∞–π–æ–Ω—É
            const bounds = layer.getBounds();
            map.fitBounds(bounds, { padding: [30, 30] });
            
            // –ü—ñ–¥—Å–≤—ñ—á—É—î–º–æ –≤–∏–±—Ä–∞–Ω–∏–π —Ä–∞–π–æ–Ω
            districtLayer.eachLayer(l => {
                l.setStyle({
                    fillOpacity: 0.05,
                    weight: 2
                });
            });
            layer.setStyle({
                fillOpacity: 0.2,
                weight: 4
            });
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –Ω–∞–∑–≤–∏ –ª—ñ–∫–∞—Ä–µ–Ω—å –≤ —Ä–∞–π–æ–Ω—ñ
            showDistrictLabels(districtName);
            
            showToast(`üìç ${districtName} —Ä–∞–π–æ–Ω`);
        }
        
        // ============ SHOW DISTRICT LABELS ============
        function showDistrictLabels(districtName) {
            labelsLayer.clearLayers();
            if (districtLabelLayer) {
                map.removeLayer(districtLabelLayer);
            }
            
            // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ª—ñ–∫–∞—Ä–Ω—ñ —Ä–∞–π–æ–Ω—É
            const districtFacilities = facilities.filter(f => f.district === districtName);
            
            // –î–æ–¥–∞—î–º–æ –º—ñ—Ç–∫–∏ –¥–ª—è –∫–æ–∂–Ω–æ—ó –ª—ñ–∫–∞—Ä–Ω—ñ
            districtFacilities.forEach(f => {
                const networkClass = f.network === '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞' ? 'nadklusterna' : 
                                     f.network === '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞' ? 'klusterna' : 'zagalna';
                
                const label = L.marker([f.lat, f.lng], {
                    icon: L.divIcon({
                        className: 'facility-label-wrapper',
                        html: `<div class="facility-label ${networkClass}">${f.name.replace(/–ö–ù–ü |–ö–ü /g, '').replace(/"/g, '')}</div>`,
                        iconSize: [200, 30],
                        iconAnchor: [-20, 15]
                    })
                });
                labelsLayer.addLayer(label);
            });
            
            // –î–æ–¥–∞—î–º–æ –≤–µ–ª–∏–∫—É –Ω–∞–∑–≤—É —Ä–∞–π–æ–Ω—É
            const feature = districtBoundaries.features.find(f => f.properties.name === districtName);
            if (feature) {
                const center = getPolygonCenter(feature.geometry.coordinates[0]);
                districtLabelLayer = L.marker([center.lat, center.lng], {
                    icon: L.divIcon({
                        className: 'district-label-wrapper',
                        html: `<div class="district-label">üìç ${districtName} —Ä–∞–π–æ–Ω</div>`,
                        iconSize: [200, 40],
                        iconAnchor: [100, 20]
                    })
                }).addTo(map);
            }
        }
        
        // –û—Ç—Ä–∏–º–∞—Ç–∏ —Ü–µ–Ω—Ç—Ä –ø–æ–ª—ñ–≥–æ–Ω—É
        function getPolygonCenter(coords) {
            let latSum = 0, lngSum = 0;
            coords.forEach(([lng, lat]) => {
                latSum += lat;
                lngSum += lng;
            });
            return {
                lat: latSum / coords.length,
                lng: lngSum / coords.length
            };
        }
        
        // –°–∫–∏–Ω—É—Ç–∏ –≤–∏–±—ñ—Ä —Ä–∞–π–æ–Ω—É
        function resetDistrictSelection() {
            selectedDistrict = null;
            labelsLayer.clearLayers();
            if (districtLabelLayer) {
                map.removeLayer(districtLabelLayer);
                districtLabelLayer = null;
            }
            
            // –°–∫–∏–Ω—É—Ç–∏ —Å—Ç–∏–ª—ñ —Ä–∞–π–æ–Ω—ñ–≤
            if (districtLayer) {
                districtLayer.eachLayer(l => {
                    l.setStyle({
                        fillOpacity: 0.05,
                        weight: 2
                    });
                });
            }
        }
        
        // ============ MARKERS ============
        function getMarkerIcon(network) {
            const colors = {
                '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞': { bg: '#9333ea', icon: '‚≠ê' },
                '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞': { bg: '#2563eb', icon: 'üè•' },
                '–ó–∞–≥–∞–ª—å–Ω–∞': { bg: '#475569', icon: 'üèõÔ∏è' }
            };
            
            const config = colors[network] || colors['–ó–∞–≥–∞–ª—å–Ω–∞'];
            
            return L.divIcon({
                className: 'custom-marker',
                html: `<div style="
                    background: ${config.bg};
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 18px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    border: 3px solid rgba(255,255,255,0.9);
                ">${config.icon}</div>`,
                iconSize: [36, 36],
                iconAnchor: [18, 18]
            });
        }
        
        function createMarkers(filter = null) {
            markersLayer.clearLayers();
            
            let filteredFacilities = facilities;
            if (filter) {
                filteredFacilities = facilities.filter(f => f.network === filter);
            }
            
            filteredFacilities.forEach(f => {
                const marker = L.marker([f.lat, f.lng], {
                    icon: getMarkerIcon(f.network)
                });
                
                const routes = getRoutesForFacility(f);
                let routesHtml = '';
                
                if (routes.length > 0) {
                    routesHtml = `
                        <div class="popup-routes">
                            <div class="popup-routes-title">–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤:</div>
                            ${routes.map(r => `
                                <div class="popup-route-item">
                                    <span class="popup-route-arrow">‚Üí</span>
                                    ${r}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                marker.bindPopup(`
                    <div class="popup-content">
                        <div class="popup-title">${f.name}</div>
                        <div class="popup-subtitle">${f.district} —Ä–∞–π–æ–Ω ‚Ä¢ ${f.type}</div>
                        <div class="popup-network ${f.network === '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞' ? 'nadklusterna' : f.network === '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞' ? 'klusterna' : 'zagalna'}">
                            ${f.network}
                        </div>
                        ${routesHtml}
                    </div>
                `);
                
                markersLayer.addLayer(marker);
            });
        }
        
        function getRoutesForFacility(facility) {
            const routes = [];
            
            if (facility.network === '–ó–∞–≥–∞–ª—å–Ω–∞') {
                // –ó–∞–≥–∞–ª—å–Ω—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å –≤—ñ–¥ –¶–ü–ú–°–î, –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—å –¥–æ –∫–ª–∞—Å—Ç–µ—Ä–Ω–∏—Ö
                routes.push('–ü—Ä–∏–π–º–∞—î: –ø–ª–∞–Ω–æ–≤—ñ –ø–∞—Ü—ñ—î–Ω—Ç–∏ –≤—ñ–¥ –¶–ü–ú–°–î');
                const clusterHosp = facilities.find(f => f.network === '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞' && f.district === facility.district);
                if (clusterHosp) {
                    routes.push(`–ù–∞–ø—Ä–∞–≤–ª—è—î —É—Ä–≥–µ–Ω—Ç–Ω—ñ –¥–æ: ${clusterHosp.name.substring(0, 40)}...`);
                }
            } else if (facility.network === '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞') {
                // –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å –≤—ñ–¥ –∑–∞–≥–∞–ª—å–Ω–∏—Ö —Ç–∞ –®–ú–î
                routes.push('–ü—Ä–∏–π–º–∞—î: —É—Ä–≥–µ–Ω—Ç–Ω—ñ –≤–∏–ø–∞–¥–∫–∏, –®–ú–î');
                routes.push('–ü—Ä–∏–π–º–∞—î: –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤—ñ–¥ –∑–∞–≥–∞–ª—å–Ω–∏—Ö –ó–û–ó');
                routes.push('–ù–∞–ø—Ä–∞–≤–ª—è—î —Å–∫–ª–∞–¥–Ω—ñ –≤–∏–ø–∞–¥–∫–∏ –¥–æ: –ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∏—Ö');
            } else if (facility.network === '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞') {
                // –ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ - –≤–µ—Ä—Ö–Ω—ñ–π —Ä—ñ–≤–µ–Ω—å
                routes.push('–ü—Ä–∏–π–º–∞—î: —Å–∫–ª–∞–¥–Ω—ñ –≤–∏–ø–∞–¥–∫–∏ –≤—ñ–¥ –∫–ª–∞—Å—Ç–µ—Ä–Ω–∏—Ö');
                routes.push('–í–∏—Å–æ–∫–æ—Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –º–µ–¥–∏—á–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞');
            }
            
            return routes;
        }
        
        // ============ –ì–ï–ù–ï–†–ê–¶–Ü–Ø –¶–ü–ú–°–î –¢–û–ß–û–ö –í –ú–ï–ñ–ê–• –†–ê–ô–û–ù–Ü–í ============
        
        // –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —á–∏ —Ç–æ—á–∫–∞ –≤ –ø–æ–ª—ñ–≥–æ–Ω—ñ (ray casting algorithm)
        function pointInPolygon(lat, lng, polygon) {
            const coords = polygon[0]; // –ë–µ—Ä–µ–º–æ –∑–æ–≤–Ω—ñ—à–Ω—î –∫—ñ–ª—å—Ü–µ –ø–æ–ª—ñ–≥–æ–Ω—É
            let inside = false;
            
            for (let i = 0, j = coords.length - 1; i < coords.length; j = i++) {
                const xi = coords[i][0], yi = coords[i][1];
                const xj = coords[j][0], yj = coords[j][1];
                
                const intersect = ((yi > lat) !== (yj > lat))
                    && (lng < (xj - xi) * (lat - yi) / (yj - yi) + xi);
                if (intersect) inside = !inside;
            }
            
            return inside;
        }
        
        // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ–ª—ñ–≥–æ–Ω —Ä–∞–π–æ–Ω—É –∑–∞ –Ω–∞–∑–≤–æ—é
        function getDistrictPolygon(districtName) {
            const feature = districtBoundaries.features.find(f => f.properties.name === districtName);
            return feature ? feature.geometry.coordinates : null;
        }
        
        // –û—Ç—Ä–∏–º—É—î–º–æ bounding box –ø–æ–ª—ñ–≥–æ–Ω—É
        function getPolygonBounds(polygon) {
            const coords = polygon[0];
            let minLat = Infinity, maxLat = -Infinity;
            let minLng = Infinity, maxLng = -Infinity;
            
            coords.forEach(([lng, lat]) => {
                if (lat < minLat) minLat = lat;
                if (lat > maxLat) maxLat = lat;
                if (lng < minLng) minLng = lng;
                if (lng > maxLng) maxLng = lng;
            });
            
            return { minLat, maxLat, minLng, maxLng };
        }
        
        // –ì–µ–Ω–µ—Ä—É—î–º–æ –¶–ü–ú–°–î —Ç–æ—á–∫–∏ —Å—Ç—Ä–æ–≥–æ –≤ –º–µ–∂–∞—Ö —Ä–∞–π–æ–Ω—ñ–≤
        function generateCpmsdPoints() {
            const points = [];
            const pointsPerDistrict = {
                '–û–¥–µ—Å—å–∫–∏–π': 15,
                '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π': 8,
                '–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π': 8,
                '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π': 10,
                '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π': 12,
                '–†–æ–∑–¥—ñ–ª—å–Ω—è–Ω—Å—å–∫–∏–π': 7,
                '–ë–µ—Ä–µ–∑—ñ–≤—Å—å–∫–∏–π': 8
            };
            
            Object.keys(pointsPerDistrict).forEach(district => {
                const polygon = getDistrictPolygon(district);
                if (!polygon) return;
                
                const bounds = getPolygonBounds(polygon);
                const count = pointsPerDistrict[district];
                let generated = 0;
                let attempts = 0;
                const maxAttempts = count * 50; // –ú–∞–∫—Å–∏–º—É–º —Å–ø—Ä–æ–±
                
                while (generated < count && attempts < maxAttempts) {
                    attempts++;
                    
                    // –í–∏–ø–∞–¥–∫–æ–≤–∞ —Ç–æ—á–∫–∞ –≤ bounding box
                    const lat = bounds.minLat + Math.random() * (bounds.maxLat - bounds.minLat);
                    const lng = bounds.minLng + Math.random() * (bounds.maxLng - bounds.minLng);
                    
                    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ç–æ—á–∫–∞ –≤ –º–µ–∂–∞—Ö –ø–æ–ª—ñ–≥–æ–Ω—É
                    if (pointInPolygon(lat, lng, polygon)) {
                        points.push({
                            name: `–¶–ü–ú–°–î ${district} #${generated + 1}`,
                            district: district,
                            lat: lat,
                            lng: lng
                        });
                        generated++;
                    }
                }
            });
            
            return points;
        }
        
        const cpmsdPoints = generateCpmsdPoints();
        
        // –ì–æ–ª–æ–≤–Ω—ñ –Ω–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ –ª—ñ–∫–∞—Ä–Ω—ñ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó
        const OOKL = facilities.find(f => f.id === 1); // –û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å–Ω–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è
        const OODKL = facilities.find(f => f.id === 2); // –û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å–Ω–∞ –¥–∏—Ç—è—á–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è
        
        // ============ ROUTES ============
        function createRoutes() {
            routesLayer.clearLayers();
            
            const klusterna = facilities.filter(f => f.network === '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞');
            const zagalna = facilities.filter(f => f.network === '–ó–∞–≥–∞–ª—å–Ω–∞');
            
            if (currentView === 1) {
                // –†–ï–ñ–ò–ú 1: –¶–ü–ú–°–î ‚Üí –ó–∞–≥–∞–ª—å–Ω—ñ –ó–û–ó
                cpmsdPoints.forEach(cpmsd => {
                    // –ó–Ω–∞–π—Ç–∏ –Ω–∞–π–±–ª–∏–∂—á—É –∑–∞–≥–∞–ª—å–Ω—É –ª—ñ–∫–∞—Ä–Ω—é –≤ —Ç–æ–º—É –∂ —Ä–∞–π–æ–Ω—ñ
                    const zagalniInDistrict = zagalna.filter(z => z.district === cpmsd.district);
                    const target = zagalniInDistrict.length > 0 ? findNearest(cpmsd, zagalniInDistrict) : findNearest(cpmsd, zagalna);
                    
                    if (target) {
                        // –õ—ñ–Ω—ñ—è –≤—ñ–¥ –¶–ü–ú–°–î –¥–æ –ó–∞–≥–∞–ª—å–Ω–æ—ó
                        const route = L.polyline(
                            [[cpmsd.lat, cpmsd.lng], [target.lat, target.lng]],
                            {
                                color: '#059669', // –∑–µ–ª–µ–Ω–∏–π
                                weight: 2,
                                opacity: 0.6,
                                dashArray: '6, 6'
                            }
                        );
                        routesLayer.addLayer(route);
                        
                        // –ú–∞—Ä–∫–µ—Ä –¶–ü–ú–°–î
                        const cpmsdMarker = L.circleMarker([cpmsd.lat, cpmsd.lng], {
                            radius: 6,
                            fillColor: '#10b981',
                            color: '#059669',
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.8
                        });
                        cpmsdMarker.bindTooltip(cpmsd.name, { direction: 'top', offset: [0, -5] });
                        routesLayer.addLayer(cpmsdMarker);
                    }
                });
            }
            
            if (currentView === 2) {
                // –†–ï–ñ–ò–ú 2: –ó–∞–≥–∞–ª—å–Ω—ñ ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ (–Ω–∞–π–±–ª–∏–∂—á–∞ –≤ —Ä–∞–π–æ–Ω—ñ –∞–±–æ –Ω–∞–π–±–ª–∏–∂—á–∞ –∑–∞–≥–∞–ª–æ–º)
                zagalna.forEach(zag => {
                    let targetKlus;
                    
                    // –î–ª—è –û–¥–µ—Å—å–∫–æ–≥–æ —Ä–∞–π–æ–Ω—É - —à—É–∫–∞—î–º–æ –Ω–∞–π–±–ª–∏–∂—á—É —Å–µ—Ä–µ–¥ –∫–ª–∞—Å—Ç–µ—Ä–Ω–∏—Ö –≤ —Ä–∞–π–æ–Ω—ñ
                    if (zag.district === '–û–¥–µ—Å—å–∫–∏–π') {
                        const klusterniInDistrict = klusterna.filter(k => k.district === '–û–¥–µ—Å—å–∫–∏–π');
                        targetKlus = findNearest(zag, klusterniInDistrict);
                        
                        if (targetKlus) {
                            const route = L.polyline(
                                [[zag.lat, zag.lng], [targetKlus.lat, targetKlus.lng]],
                                {
                                    color: '#ea580c',
                                    weight: 2.5,
                                    opacity: 0.7,
                                    dashArray: '8, 6'
                                }
                            );
                            routesLayer.addLayer(route);
                        }
                    }
                    // –î–ª—è –ü–æ–¥—ñ–ª—å—Å—å–∫–æ–≥–æ —Ä–∞–π–æ–Ω—É - –º–∞—Ä—à—Ä—É—Ç–∏ —ñ –¥–æ –ë–∞–ª—Ç–∏, —ñ –¥–æ –ü–æ–¥—ñ–ª—å—Å—å–∫–∞
                    else if (zag.district === '–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π') {
                        const baltska = facilities.find(f => f.id === 18); // –ë–∞–ª—Ç—Å—å–∫–∞
                        const podilska = facilities.find(f => f.id === 27); // –ü–æ–¥—ñ–ª—å—Å—å–∫–∞
                        
                        [baltska, podilska].forEach(target => {
                            if (target) {
                                const route = L.polyline(
                                    [[zag.lat, zag.lng], [target.lat, target.lng]],
                                    {
                                        color: '#ea580c',
                                        weight: 2.5,
                                        opacity: 0.7,
                                        dashArray: '8, 6'
                                    }
                                );
                                routesLayer.addLayer(route);
                            }
                        });
                    }
                    else {
                        // –î–ª—è —ñ–Ω—à–∏—Ö —Ä–∞–π–æ–Ω—ñ–≤ - —Å–ø–æ—á–∞—Ç–∫—É —à—É–∫–∞—î–º–æ –∫–ª–∞—Å—Ç–µ—Ä–Ω—É –≤ —Ç–æ–º—É –∂ —Ä–∞–π–æ–Ω—ñ
                        targetKlus = klusterna.find(k => k.district === zag.district);
                        
                        // –Ø–∫—â–æ –Ω–µ–º–∞—î –≤ —Ä–∞–π–æ–Ω—ñ - —à—É–∫–∞—î–º–æ –Ω–∞–π–±–ª–∏–∂—á—É
                        if (!targetKlus) {
                            targetKlus = findNearest(zag, klusterna);
                        }
                        
                        if (targetKlus) {
                            const route = L.polyline(
                                [[zag.lat, zag.lng], [targetKlus.lat, targetKlus.lng]],
                                {
                                    color: '#ea580c',
                                    weight: 2.5,
                                    opacity: 0.7,
                                    dashArray: '8, 6'
                                }
                            );
                            routesLayer.addLayer(route);
                        }
                    }
                });
            }
            
            if (currentView === 3) {
                // –†–ï–ñ–ò–ú 3: –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ ‚Üí –ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ (–û–û–ö–õ, –û–û–î–ö–õ, –î—É–Ω–∞–π—Å—å–∫–∞)
                const DUNAY = facilities.find(f => f.id === 7); // –î—É–Ω–∞–π—Å—å–∫–∞ —Ñ—ñ–ª—ñ—è
                
                klusterna.forEach(klus => {
                    // –î–∏—Ç—è—á—ñ –ª—ñ–∫–∞—Ä–Ω—ñ –π–¥—É—Ç—å –¥–æ –û–û–î–ö–õ, —Ä–µ—à—Ç–∞ –¥–æ –û–û–ö–õ
                    const isDitiacha = klus.name.toLowerCase().includes('–¥–∏—Ç—è—á');
                    const target = isDitiacha ? OODKL : OOKL;
                    
                    if (target) {
                        const route = L.polyline(
                            [[klus.lat, klus.lng], [target.lat, target.lng]],
                            {
                                color: '#dc2626', // —á–µ—Ä–≤–æ–Ω–∏–π
                                weight: 3,
                                opacity: 0.8,
                                dashArray: '10, 6'
                            }
                        );
                        routesLayer.addLayer(route);
                    }
                });
                
                // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–∞—Ä—à—Ä—É—Ç–∏ –¥–æ –î—É–Ω–∞–π—Å—å–∫–æ—ó —Ñ—ñ–ª—ñ—ó (–ê—Ä—Ü–∏–∑ id=17, –Ü–∑–º–∞—ó–ª id=22)
                if (DUNAY) {
                    const artsyz = facilities.find(f => f.id === 17);
                    const izmail = facilities.find(f => f.id === 22);
                    
                    [artsyz, izmail].forEach(klus => {
                        if (klus) {
                            const routeToDunay = L.polyline(
                                [[klus.lat, klus.lng], [DUNAY.lat, DUNAY.lng]],
                                {
                                    color: '#dc2626', // —á–µ—Ä–≤–æ–Ω–∏–π
                                    weight: 3,
                                    opacity: 0.8,
                                    dashArray: '10, 6'
                                }
                            );
                            routesLayer.addLayer(routeToDunay);
                        }
                    });
                }
                
                // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ª—ñ–Ω—ñ—è –∑–≤'—è–∑–∫—É –º—ñ–∂ –û–û–ö–õ —Ç–∞ –û–û–î–ö–õ
                if (OOKL && OODKL) {
                    const connectionRoute = L.polyline(
                        [[OOKL.lat, OOKL.lng], [OODKL.lat, OODKL.lng]],
                        {
                            color: '#9333ea', // —Ñ—ñ–æ–ª–µ—Ç–æ–≤–∏–π
                            weight: 4,
                            opacity: 0.9,
                            dashArray: '4, 4'
                        }
                    );
                    routesLayer.addLayer(connectionRoute);
                }
            }
            
            // –†–ï–ñ–ò–ú 4: –ï–ö–°–¢–†–ï–ù–ò–ô - –ø—ñ–≤–¥–µ–Ω–Ω—ñ —Ä–∞–π–æ–Ω–∏ –±–µ–∑ —Å–ø–æ–ª—É—á–µ–Ω–Ω—è –∑ –û–¥–µ—Å–æ—é
            if (currentView === 4) {
                const emergencyDistricts = ['–ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π', '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π', '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π'];
                const DUNAY = facilities.find(f => f.id === 7); // –î—É–Ω–∞–π—Å—å–∫–∞ —Ñ—ñ–ª—ñ—è
                const IZMAIL = facilities.find(f => f.id === 22); // –Ü–∑–º–∞—ó–ª—å—Å—å–∫–∞ –º—ñ—Å—å–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞
                const SAFYANY = facilities.find(f => f.id === 42); // –°–∞—Ñ'—è–Ω—ñ–≤—Å—å–∫–∞ –¶–†–õ
                const ARTSYZ = facilities.find(f => f.id === 17); // –ê—Ä—Ü–∏–∑—å–∫–∞
                const BILGOROD = facilities.find(f => f.id === 21); // –ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∞
                
                // –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏—Ö
                const contacts = {
                    dunay: {
                        name: '–í–î "–î—É–Ω–∞–π—Å—å–∫–∞ —Ñ—ñ–ª—ñ—è" –û–û–ö–õ',
                        chief: '–î—ñ–º–æ–≤ –û–ª–µ–≥ –§–µ–¥–æ—Ä–æ–≤–∏—á',
                        phone: '0954601102',
                        coordinator: '–°—Ç–µ—Ñ–∞–Ω—á—É–∫ –ê–Ω–¥—Ä—ñ–π –ê–Ω–¥—Ä—ñ–π–æ–≤–∏—á',
                        coordPhone: '0509788622'
                    },
                    izmail: {
                        name: '–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∞ –ú–¶–õ',
                        chief: '–ë–∞–∂–∞–∫ –°–µ—Ä–≥—ñ–π –î–º–∏—Ç—Ä–æ–≤–∏—á',
                        phone: '0973543451',
                        additional: '–í–µ–ª–∏–∫–æ–≤–∞ –õ.–ü. 0962888343, –ö–æ–Ω–æ–≤–∫–∞ –õ.–ü. 0984365337'
                    },
                    safyany: {
                        name: '–°–∞—Ñ\'—è–Ω—ñ–≤—Å—å–∫–∞ –¶–†–õ',
                        chief: '–°–∞–¥–∫–æ–≤—Å—å–∫–∏–π –û–ª–µ–≥ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á',
                        phone: '0979998244'
                    },
                    artsyz: { name: '–ê—Ä—Ü–∏–∑—å–∫–∞ –¶–û–õ', service: '–Ü–Ω—Å—É–ª—å—Ç–Ω–∏–π —Ü–µ–Ω—Ç—Ä' },
                    bilgorod: { name: '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∞ –ú–ë–õ', service: '–Ü–Ω—Å—É–ª—å—Ç–Ω–∏–π —Ü–µ–Ω—Ç—Ä' }
                };
                
                // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –∑–∞–∫–ª–∞–¥–∏ —Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø—ñ–≤–¥–µ–Ω–Ω–∏—Ö —Ä–∞–π–æ–Ω—ñ–≤
                const emergencyZagalna = zagalna.filter(z => emergencyDistricts.includes(z.district));
                const emergencyKlusterna = klusterna.filter(k => emergencyDistricts.includes(k.district));
                
                // –û—á–∏—â—É—î–º–æ –º—ñ—Ç–∫–∏
                mapLabelsLayer.clearLayers();
                
                const shouldShow = (type) => currentEmergencyRoute === 'all' || currentEmergencyRoute === type;
                
                // ===== –ó–∞–≥–∞–ª—å–Ω—ñ ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ =====
                if (shouldShow('general')) {
                    // –ì—Ä—É–ø—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω—ñ –∑–∞ –Ω–∞–π–±–ª–∏–∂—á–æ—é –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ—é
                    const klusTargets = {};
                    emergencyZagalna.forEach(zag => {
                        const nearestKlus = findNearest(zag, emergencyKlusterna);
                        if (nearestKlus) {
                            if (!klusTargets[nearestKlus.id]) klusTargets[nearestKlus.id] = [];
                            klusTargets[nearestKlus.id].push(zag);
                            
                            const route = L.polyline(
                                [[zag.lat, zag.lng], [nearestKlus.lat, nearestKlus.lng]],
                                { color: '#ea580c', weight: 2.5, opacity: 0.7, dashArray: '8, 6' }
                            );
                            routesLayer.addLayer(route);
                            addArrowToRoute(zag, nearestKlus, '#ea580c');
                        }
                    });
                    
                    // –ú–∞–ª–µ–Ω—å–∫—ñ –º—ñ—Ç–∫–∏ –¥–ª—è –∑–∞–≥–∞–ª—å–Ω–∏—Ö –ª—ñ–∫–∞—Ä–µ–Ω—å
                    emergencyZagalna.forEach(zag => {
                        addSmallLabel(zag, '#ea580c');
                    });
                    
                    // –ú—ñ—Ç–∫–∏ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–Ω–∏—Ö (–∫—É–¥–∏ –≤–µ–∑—É—Ç—å)
                    emergencyKlusterna.forEach(klus => {
                        const shortName = klus.name.replace(/–ö–ù–ü |–ö–ü |"/g, '').replace(/"$/, '');
                        addMapLabel(klus.lat, klus.lng, `üè• ${shortName}`, 'klusterna', true);
                    });
                }
                
                // ===== –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ ‚Üí –î—É–Ω–∞–π—Å—å–∫–∞ —Ñ—ñ–ª—ñ—è (–Ω–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞) =====
                if (shouldShow('nadkluster')) {
                    emergencyKlusterna.forEach(klus => {
                        if (DUNAY) {
                            const route = L.polyline(
                                [[klus.lat, klus.lng], [DUNAY.lat, DUNAY.lng]],
                                { color: '#dc2626', weight: 3, opacity: 0.8, dashArray: '10, 6' }
                            );
                            routesLayer.addLayer(route);
                            addArrowToRoute(klus, DUNAY, '#dc2626');
                        }
                        // –ú–∞–ª–µ–Ω—å–∫–∞ –º—ñ—Ç–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ—ó
                        addSmallLabel(klus, '#dc2626');
                    });
                    
                    // –ú—ñ—Ç–∫–∞ –î—É–Ω–∞–π—Å—å–∫–æ—ó –∑ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
                    if (DUNAY) {
                        addMapLabelWithContact(DUNAY.lat, DUNAY.lng, contacts.dunay, 'nadklusterna');
                    }
                }
                
                // ===== –Ü–Ω—Å—É–ª—å—Ç / –Ü–Ω—Ñ–∞—Ä–∫—Ç =====
                if (shouldShow('stroke')) {
                    const strokeCenters = [ARTSYZ, IZMAIL, BILGOROD].filter(Boolean);
                    
                    // –í—Å—ñ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ —Ç–∞ –∑–∞–≥–∞–ª—å–Ω—ñ –≤–µ–¥—É—Ç—å –¥–æ —Ü–µ–Ω—Ç—Ä—ñ–≤ —ñ–Ω—Å—É–ª—å—Ç–Ω–æ—ó –¥–æ–ø–æ–º–æ–≥–∏
                    emergencyZagalna.forEach(zag => {
                        const nearestStroke = findNearest(zag, strokeCenters);
                        if (nearestStroke) {
                            const route = L.polyline(
                                [[zag.lat, zag.lng], [nearestStroke.lat, nearestStroke.lng]],
                                { color: '#7c3aed', weight: 2, opacity: 0.6, dashArray: '4, 6' }
                            );
                            routesLayer.addLayer(route);
                            addArrowToRoute(zag, nearestStroke, '#7c3aed');
                        }
                        // –ú–∞–ª–µ–Ω—å–∫–∞ –º—ñ—Ç–∫–∞ –∑–∞–≥–∞–ª—å–Ω–æ—ó
                        addSmallLabel(zag, '#7c3aed');
                    });
                    
                    // –õ—ñ–Ω—ñ—ó –≤—ñ–¥ —ñ–Ω—Å—É–ª—å—Ç–Ω–∏—Ö —Ü–µ–Ω—Ç—Ä—ñ–≤ –¥–æ –î—É–Ω–∞–π—Å—å–∫–æ—ó (—Ç—Ä–æ–º–±–æ–µ–∫—Å—Ç—Ä–∞–∫—Ü—ñ—è)
                    strokeCenters.forEach(center => {
                        if (DUNAY) {
                            const route = L.polyline(
                                [[center.lat, center.lng], [DUNAY.lat, DUNAY.lng]],
                                { color: '#7c3aed', weight: 4, opacity: 0.9, dashArray: '4, 8' }
                            );
                            routesLayer.addLayer(route);
                            addArrowToRoute(center, DUNAY, '#7c3aed');
                        }
                    });
                    
                    // –ú—ñ—Ç–∫–∏
                    if (DUNAY) {
                        addMapLabelWithContact(DUNAY.lat, DUNAY.lng, {
                            ...contacts.dunay,
                            service: 'üß† –¢–†–û–ú–ë–û–ï–ö–°–¢–†–ê–ö–¶–Ü–Ø / –Ü–ù–§–ê–†–ö–¢'
                        }, 'stroke');
                    }
                    if (ARTSYZ) addMapLabel(ARTSYZ.lat, ARTSYZ.lng, 'üß† ' + contacts.artsyz.name + '\\n–Ü–Ω—Å—É–ª—å—Ç–Ω–∏–π —Ü–µ–Ω—Ç—Ä', 'stroke', true);
                    if (IZMAIL) addMapLabel(IZMAIL.lat, IZMAIL.lng, 'üß† ' + contacts.izmail.name + '\\n–Ü–Ω—Å—É–ª—å—Ç–Ω–∏–π —Ü–µ–Ω—Ç—Ä', 'stroke', true);
                    if (BILGOROD) addMapLabel(BILGOROD.lat, BILGOROD.lng, 'üß† ' + contacts.bilgorod.name + '\\n–Ü–Ω—Å—É–ª—å—Ç–Ω–∏–π —Ü–µ–Ω—Ç—Ä', 'stroke', true);
                }
                
                // ===== –ü–µ—Ä–∏–Ω–∞—Ç–∞–ª—å–Ω–∞ / –ù–µ–æ–Ω–∞—Ç–æ–ª–æ–≥—ñ—è / –¢—Ä–∞–Ω—Å—Ñ—É–∑—ñ–æ–ª–æ–≥—ñ—è =====
                if (shouldShow('perinatal')) {
                    // –í—ñ–¥ —É—Å—ñ—Ö –∑–∞–∫–ª–∞–¥—ñ–≤ –¥–æ –Ü–∑–º–∞—ó–ª—å—Å—å–∫–æ—ó
                    if (IZMAIL) {
                        [...emergencyZagalna, ...emergencyKlusterna].forEach(facility => {
                            if (facility.id !== 22) {
                                const route = L.polyline(
                                    [[facility.lat, facility.lng], [IZMAIL.lat, IZMAIL.lng]],
                                    { color: '#0891b2', weight: 2.5, opacity: 0.7, dashArray: '6, 4' }
                                );
                                routesLayer.addLayer(route);
                                addArrowToRoute(facility, IZMAIL, '#0891b2');
                                // –ú–∞–ª–µ–Ω—å–∫–∞ –º—ñ—Ç–∫–∞
                                addSmallLabel(facility, '#0891b2');
                            }
                        });
                        
                        // –ú—ñ—Ç–∫–∞ –∑ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
                        addMapLabelWithContact(IZMAIL.lat, IZMAIL.lng, {
                            ...contacts.izmail,
                            service: 'üë∂ –ü–ï–†–ò–ù–ê–¢–ê–õ–¨–ù–ò–ô –¶–ï–ù–¢–†\\nüíâ –ù–µ–æ–Ω–∞—Ç–æ–ª–æ–≥—ñ—è / –¢—Ä–∞–Ω—Å—Ñ—É–∑—ñ–æ–ª–æ–≥—ñ—è'
                        }, 'perinatal');
                    }
                }
                
                // ===== –û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥—ñ—è / –õ–û–† =====
                if (shouldShow('ophthalm')) {
                    if (SAFYANY) {
                        // –í—ñ–¥ —É—Å—ñ—Ö –∑–∞–∫–ª–∞–¥—ñ–≤ –¥–æ –°–∞—Ñ'—è–Ω—ñ–≤—Å—å–∫–æ—ó
                        [...emergencyZagalna, ...emergencyKlusterna].forEach(facility => {
                            if (facility.id !== 42) {
                                const route = L.polyline(
                                    [[facility.lat, facility.lng], [SAFYANY.lat, SAFYANY.lng]],
                                    { color: '#059669', weight: 2.5, opacity: 0.7, dashArray: '4, 4' }
                                );
                                routesLayer.addLayer(route);
                                addArrowToRoute(facility, SAFYANY, '#059669');
                                // –ú–∞–ª–µ–Ω—å–∫–∞ –º—ñ—Ç–∫–∞
                                addSmallLabel(facility, '#059669');
                            }
                        });
                        
                        // –ú—ñ—Ç–∫–∞ –∑ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
                        addMapLabelWithContact(SAFYANY.lat, SAFYANY.lng, {
                            ...contacts.safyany,
                            service: 'üëÅÔ∏è –û–§–¢–ê–õ–¨–ú–û–õ–û–ì–Ü–Ø / üëÇ –õ–û–†\\n–•—ñ—Ä—É—Ä–≥—ñ—á–Ω–µ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è'
                        }, 'ophthalm');
                    }
                }
                
                // –ó—É–º—É—î–º–æ –¥–æ –ø—ñ–≤–¥–µ–Ω–Ω–∏—Ö —Ä–∞–π–æ–Ω—ñ–≤
                map.fitBounds([[45.2, 28.2], [46.5, 30.4]], { padding: [20, 20] });
            }
        }
        
        // –§—É–Ω–∫—Ü—ñ—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤—ñ–¥—Å—Ç–∞–Ω—ñ –≤ –∫–º (Haversine formula)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // –†–∞–¥—ñ—É—Å –ó–µ–º–ª—ñ –≤ –∫–º
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // –§—É–Ω–∫—Ü—ñ—è —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è –Ω–∞–∑–≤–∏ –ª—ñ–∫–∞—Ä–Ω—ñ
        function shortenName(name) {
            return name
                .replace(/–ö–ù–ü |–ö–ü |"/g, '')
                .replace(/"$/, '')
                .replace(/–û–¥–µ—Å—å–∫–æ—ó –æ–±–ª–∞—Å–Ω–æ—ó —Ä–∞–¥–∏|–û–û–†/g, '')
                .replace(/–±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è/gi, '–ë–õ')
                .replace(/—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ —Ä–∞–π–æ–Ω–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è/gi, '–¶–†–õ')
                .replace(/—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –æ–ø–æ—Ä–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è/gi, '–¶–û–õ')
                .replace(/–º—ñ—Å—å–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è/gi, '–ú–¶–õ')
                .replace(/–º—ñ—Å—å–∫–∞ –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ñ—ñ–ª—å–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è/gi, '–ú–ë–õ')
                .replace(/—ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–≥–æ –ª—ñ–∫—É–≤–∞–Ω–Ω—è/gi, '–Ü–õ')
                .trim();
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Å—Ç—Ä—ñ–ª–∫–∏ –Ω–∞ –º–∞—Ä—à—Ä—É—Ç –∑ –≤—ñ–¥—Å—Ç–∞–Ω–Ω—é
        function addArrowToRoute(from, to, color, showDistance = true) {
            const midLat = (from.lat + to.lat) / 2;
            const midLng = (from.lng + to.lng) / 2;
            
            // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –∫—É—Ç —Å—Ç—Ä—ñ–ª–∫–∏
            const angle = Math.atan2(to.lng - from.lng, to.lat - from.lat) * 180 / Math.PI;
            
            // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –≤—ñ–¥—Å—Ç–∞–Ω—å
            const distance = calculateDistance(from.lat, from.lng, to.lat, to.lng);
            const distText = distance.toFixed(0) + ' –∫–º';
            
            const arrow = L.marker([midLat, midLng], {
                icon: L.divIcon({
                    className: 'route-arrow-wrapper',
                    html: `<div class="arrow-with-distance">
                        <span class="arrow-icon" style="color: ${color}; transform: rotate(${angle - 90}deg);">‚û§</span>
                        ${showDistance ? `<span class="distance-label" style="color: ${color};">${distText}</span>` : ''}
                    </div>`,
                    iconSize: [60, 30],
                    iconAnchor: [30, 15]
                })
            });
            routesLayer.addLayer(arrow);
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –º–∞–ª–µ–Ω—å–∫–æ—ó –º—ñ—Ç–∫–∏ –Ω–∞–∑–≤–∏ –ª—ñ–∫–∞—Ä–Ω—ñ
        function addSmallLabel(facility, color) {
            const shortName = shortenName(facility.name);
            const label = L.marker([facility.lat - 0.02, facility.lng], {
                icon: L.divIcon({
                    className: 'small-label-wrapper',
                    html: `<div class="small-label" style="border-color: ${color};">${shortName}</div>`,
                    iconSize: [150, 20],
                    iconAnchor: [75, 10]
                })
            });
            mapLabelsLayer.addLayer(label);
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –º—ñ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—É
        function addMapLabel(lat, lng, text, type, offset = false) {
            const label = L.marker([lat, lng + (offset ? 0.06 : 0.1)], {
                icon: L.divIcon({
                    className: 'map-label-wrapper',
                    html: `<div class="map-label ${type}">${text.replace(/\\n/g, '<br>')}</div>`,
                    iconSize: [220, 60],
                    iconAnchor: [0, 30]
                })
            });
            mapLabelsLayer.addLayer(label);
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –º—ñ—Ç–∫–∏ –∑ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
        function addMapLabelWithContact(lat, lng, contact, type) {
            let html = `<div class="map-label-contact ${type}">`;
            if (contact.service) {
                html += `<div class="label-service">${contact.service.replace(/\\n/g, '<br>')}</div>`;
            }
            html += `<div class="label-name">üìç ${contact.name}</div>`;
            if (contact.chief) {
                html += `<div class="label-chief">üë§ ${contact.chief}</div>`;
                html += `<div class="label-phone">üìû ${contact.phone}</div>`;
            }
            if (contact.coordinator) {
                html += `<div class="label-coord">üìã ${contact.coordinator}: ${contact.coordPhone}</div>`;
            }
            if (contact.additional) {
                html += `<div class="label-add">${contact.additional}</div>`;
            }
            html += '</div>';
            
            const label = L.marker([lat, lng + 0.12], {
                icon: L.divIcon({
                    className: 'map-label-wrapper',
                    html: html,
                    iconSize: [280, 120],
                    iconAnchor: [0, 60]
                })
            });
            mapLabelsLayer.addLayer(label);
        }
        
        function findNearest(facility, candidates) {
            let nearest = null;
            let minDist = Infinity;
            
            candidates.forEach(c => {
                const dist = Math.sqrt(
                    Math.pow(facility.lat - c.lat, 2) + 
                    Math.pow(facility.lng - c.lng, 2)
                );
                if (dist < minDist) {
                    minDist = dist;
                    nearest = c;
                }
            });
            
            return nearest;
        }
        
        // ============ VIEW SWITCHING ============
        function setView(viewNum) {
            currentView = viewNum;
            
            // Update buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.view) === viewNum);
            });
            
            // –û–Ω–æ–≤–∏—Ç–∏ –∫–Ω–æ–ø–∫—É –µ–∫—Å—Ç—Ä–µ–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É
            const emergencyBtn = document.querySelector('.emergency-btn');
            if (emergencyBtn) {
                emergencyBtn.classList.toggle('active', viewNum === 4);
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏/–ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ –ø—ñ–¥–º–µ–Ω—é –µ–∫—Å—Ç—Ä–µ–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É
            const emergencySubmenu = document.getElementById('emergency-submenu');
            if (viewNum === 4) {
                emergencySubmenu.classList.add('show');
                currentEmergencyRoute = 'all';
                // –°–∫–∏–Ω—É—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É –∫–Ω–æ–ø–∫—É
                document.querySelectorAll('.emergency-route-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.route === 'all');
                });
            } else {
                emergencySubmenu.classList.remove('show');
                mapLabelsLayer.clearLayers();
            }
            
            // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –ª–µ–≥–µ–Ω–¥–∏
            const routesLegend = document.getElementById('routes-legend');
            const emergencyLegend = document.getElementById('emergency-legend');
            if (viewNum === 4) {
                routesLegend.classList.add('hidden');
                emergencyLegend.classList.remove('hidden');
            } else {
                routesLegend.classList.remove('hidden');
                emergencyLegend.classList.add('hidden');
            }
            
            // –ú–∞—Ä—à—Ä—É—Ç–∏ –∑–∞–≤–∂–¥–∏ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è
            routesVisible = true;
            routesLayer.addTo(map);
            
            createRoutes();
            updateInfoPanel(viewNum);
            
            const viewNames = {
                1: '–¶–ü–ú–°–î ‚Üí –ó–∞–≥–∞–ª—å–Ω—ñ –ó–û–ó',
                2: '–ó–∞–≥–∞–ª—å–Ω—ñ ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ',
                3: '–ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ ‚Üí –ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ',
                4: '‚ö†Ô∏è –ï–∫—Å—Ç—Ä–µ–Ω–∏–π —Ä–µ–∂–∏–º (–±–µ–∑ —Å–ø–æ–ª—É—á–µ–Ω–Ω—è)'
            };
            
            showToast(`–†–µ–∂–∏–º: ${viewNames[viewNum]}`);
        }
        
        // ============ EMERGENCY ROUTE SWITCHING ============
        function setEmergencyRoute(routeType) {
            currentEmergencyRoute = routeType;
            
            // –û–Ω–æ–≤–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.emergency-route-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.route === routeType);
            });
            
            createRoutes();
            
            const routeNames = {
                'all': '–í—Å—ñ –º–∞—Ä—à—Ä—É—Ç–∏',
                'general': '–ó–∞–≥–∞–ª—å–Ω—ñ ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ',
                'nadkluster': '–ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ ‚Üí –î—É–Ω–∞–π—Å—å–∫–∞',
                'stroke': '–Ü–Ω—Å—É–ª—å—Ç / –Ü–Ω—Ñ–∞—Ä–∫—Ç',
                'perinatal': '–ü–µ—Ä–∏–Ω–∞—Ç–∞–ª—å–Ω–∞ / –ù–µ–æ–Ω–∞—Ç–æ–ª–æ–≥—ñ—è',
                'ophthalm': '–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥—ñ—è / –õ–û–†'
            };
            
            showToast(`‚ö†Ô∏è ${routeNames[routeType]}`);
        }
        
        function updateInfoPanel(viewNum) {
            const panel = document.getElementById('info-panel');
            const title = document.getElementById('panel-title');
            const subtitle = document.getElementById('panel-subtitle');
            const content = document.getElementById('panel-content');
            const badge = document.getElementById('panel-badge');
            
            const viewData = {
                1: {
                    title: '–¶–ü–ú–°–î ‚Üí –ó–∞–≥–∞–ª—å–Ω—ñ –ó–û–ó',
                    subtitle: '–ü–µ—Ä–≤–∏–Ω–Ω–∞ –ª–∞–Ω–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª—è—î –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤',
                    badge: { text: '–†–ï–ñ–ò–ú 1 ‚Ä¢ –ó–ï–õ–ï–ù–Ü –õ–Ü–ù–Ü–á', class: 'green' },
                    content: `
                        <h4>üü¢ –ó–µ–ª–µ–Ω—ñ –ª—ñ–Ω—ñ—ó</h4>
                        <p>–ú–∞—Ä—à—Ä—É—Ç–∏ –≤—ñ–¥ –¶–ü–ú–°–î (—Ü–µ–Ω—Ç—Ä—ñ–≤ –ø–µ—Ä–≤–∏–Ω–Ω–æ—ó –º–µ–¥–∏–∫–æ-—Å–∞–Ω—ñ—Ç–∞—Ä–Ω–æ—ó –¥–æ–ø–æ–º–æ–≥–∏) –¥–æ –∑–∞–≥–∞–ª—å–Ω–∏—Ö –∑–∞–∫–ª–∞–¥—ñ–≤ –æ—Ö–æ—Ä–æ–Ω–∏ –∑–¥–æ—Ä–æ–≤'—è.</p>
                        
                        <h4>üìã –¢–∏–ø–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—å:</h4>
                        <ul>
                            <li>–ü–ª–∞–Ω–æ–≤–∞ –≥–æ—Å–ø—ñ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è</li>
                            <li>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç—ñ–≤</li>
                            <li>–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–∞ –ª—ñ–∫—É–≤–∞–Ω–Ω—è</li>
                        </ul>
                        
                        <p><strong>–¶–ü–ú–°–î</strong> ‚Äî –∑–µ–ª–µ–Ω—ñ —Ç–æ—á–∫–∏ (${cpmsdPoints.length} —à—Ç.)</p>
                    `
                },
                2: {
                    title: '–ó–∞–≥–∞–ª—å–Ω—ñ ‚Üí –ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ',
                    subtitle: '–£—Ä–≥–µ–Ω—Ç–Ω—ñ –≤–∏–ø–∞–¥–∫–∏ —Ç–∞ –®–ú–î',
                    badge: { text: '–†–ï–ñ–ò–ú 2 ‚Ä¢ –û–†–ê–ù–ñ–ï–í–Ü –õ–Ü–ù–Ü–á', class: 'orange' },
                    content: `
                        <h4>üü† –û—Ä–∞–Ω–∂–µ–≤—ñ –ª—ñ–Ω—ñ—ó</h4>
                        <p>–ú–∞—Ä—à—Ä—É—Ç–∏ –≤—ñ–¥ –∑–∞–≥–∞–ª—å–Ω–∏—Ö –ó–û–ó –¥–æ –∫–ª–∞—Å—Ç–µ—Ä–Ω–∏—Ö (–æ–ø–æ—Ä–Ω–∏—Ö) –ª—ñ–∫–∞—Ä–µ–Ω—å.</p>
                        
                        <h4>üöë –ü–æ–∫–∞–∑–∞–Ω–Ω—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥—É:</h4>
                        <ul>
                            <li>–ù–µ–≤—ñ–¥–∫–ª–∞–¥–Ω—ñ —Å—Ç–∞–Ω–∏</li>
                            <li>–ï–∫—Å—Ç—Ä–µ–Ω–∞ —Ö—ñ—Ä—É—Ä–≥—ñ—è</li>
                            <li>–¢—Ä–∞–≤–º–∏ —Ç–∞ –î–¢–ü</li>
                            <li>–ì–æ—Å—Ç—Ä—ñ —Å–µ—Ä—Ü–µ–≤–æ-—Å—É–¥–∏–Ω–Ω—ñ —Å—Ç–∞–Ω–∏</li>
                        </ul>
                        
                        <p><strong>–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è:</strong> –≤ –º–µ–∂–∞—Ö —Ä–∞–π–æ–Ω—É –∞–±–æ –¥–æ –Ω–∞–π–±–ª–∏–∂—á–æ—ó –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ—ó.</p>
                    `
                },
                3: {
                    title: '–ö–ª–∞—Å—Ç–µ—Ä–Ω—ñ ‚Üí –ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ',
                    subtitle: '–°–∫–ª–∞–¥–Ω—ñ –≤–∏–ø–∞–¥–∫–∏ –¥–æ –æ–±–ª–∞—Å–Ω–∏—Ö —Ü–µ–Ω—Ç—Ä—ñ–≤',
                    badge: { text: '–†–ï–ñ–ò–ú 3 ‚Ä¢ –ß–ï–†–í–û–ù–Ü –õ–Ü–ù–Ü–á', class: 'red' },
                    content: `
                        <h4>üî¥ –ß–µ—Ä–≤–æ–Ω—ñ –ª—ñ–Ω—ñ—ó</h4>
                        <p>–ú–∞—Ä—à—Ä—É—Ç–∏ –≤—ñ–¥ –∫–ª–∞—Å—Ç–µ—Ä–Ω–∏—Ö –ª—ñ–∫–∞—Ä–µ–Ω—å –¥–æ –Ω–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∏—Ö:</p>
                        <ul>
                            <li><strong>–û–û–ö–õ</strong> ‚Äî –û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å–Ω–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è</li>
                            <li><strong>–û–û–î–ö–õ</strong> ‚Äî –û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å–Ω–∞ –¥–∏—Ç—è—á–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è</li>
                            <li><strong>–î—É–Ω–∞–π—Å—å–∫–∞ —Ñ—ñ–ª—ñ—è</strong> ‚Äî –¥–ª—è –ê—Ä—Ü–∏–∑—å–∫–æ—ó —Ç–∞ –Ü–∑–º–∞—ó–ª—å—Å—å–∫–æ—ó –ª—ñ–∫–∞—Ä–µ–Ω—å</li>
                        </ul>
                        
                        <h4>‚ö†Ô∏è –ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø–µ—Ä–µ–≤–æ–¥—É:</h4>
                        <ul>
                            <li>–ü–æ—Ç—Ä–µ–±–∞ –≤–∏—Å–æ–∫–æ—Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ—ó –¥–æ–ø–æ–º–æ–≥–∏</li>
                            <li>–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Å—Ç–∞–Ω –ø–∞—Ü—ñ—î–Ω—Ç–∞</li>
                            <li>–°–∫–ª–∞–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ñ –≤—Ç—Ä—É—á–∞–Ω–Ω—è</li>
                        </ul>
                    `
                },
                4: {
                    title: '‚ö†Ô∏è –ï–∫—Å—Ç—Ä–µ–Ω–∏–π —Ä–µ–∂–∏–º',
                    subtitle: '–ë–µ–∑ —Å–ø–æ–ª—É—á–µ–Ω–Ω—è –∑ —Ü–µ–Ω—Ç—Ä–æ–º –û–¥–µ—Å–∏',
                    badge: { text: '–ï–ö–°–¢–†–ï–ù–ò–ô –†–ï–ñ–ò–ú', class: 'emergency' },
                    content: `
                        <h4>üö® –†–∞–π–æ–Ω–∏: –ë–æ–ª–≥—Ä–∞–¥—Å—å–∫–∏–π, –Ü–∑–º–∞—ó–ª—å—Å—å–∫–∏–π, –ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π</h4>
                        <p>–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è –ø—Ä–∏ –Ω–µ–º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Å–ø–æ–ª—É—á–µ–Ω–Ω—è –∑ —Ü–µ–Ω—Ç—Ä–æ–º –û–¥–µ—Å—å–∫–æ—ó –æ–±–ª–∞—Å—Ç—ñ.</p>
                        
                        <h4>üî¥ –ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞:</h4>
                        <p><strong>–î—É–Ω–∞–π—Å—å–∫–∞ —Ñ—ñ–ª—ñ—è –û–û–ö–õ</strong> ‚Äî –≤—Å—ñ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ –ª—ñ–∫–∞—Ä–Ω—ñ</p>
                        
                        <h4>üü£ –Ü–Ω—Å—É–ª—å—Ç / –Ü–Ω—Ñ–∞—Ä–∫—Ç:</h4>
                        <ul>
                            <li>–î—É–Ω–∞–π—Å—å–∫–∞ —Ñ—ñ–ª—ñ—è (—Ç—Ä–æ–º–±–æ–µ–∫—Å—Ç—Ä–∞–∫—Ü—ñ—è)</li>
                            <li>–ê—Ä—Ü–∏–∑, –Ü–∑–º–∞—ó–ª, –ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫</li>
                        </ul>
                        
                        <h4>üîµ –ü–µ—Ä–∏–Ω–∞—Ç–∞–ª—å–Ω–∞ / –ù–µ–æ–Ω–∞—Ç–æ–ª–æ–≥—ñ—è / –¢—Ä–∞–Ω—Å—Ñ—É–∑—ñ–æ–ª–æ–≥—ñ—è:</h4>
                        <p><strong>–Ü–∑–º–∞—ó–ª—å—Å—å–∫–∞ –ú–¶–õ</strong></p>
                        
                        <h4>üü¢ –û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥—ñ—è / –õ–û–†:</h4>
                        <p><strong>–°–∞—Ñ'—è–Ω—ñ–≤—Å—å–∫–∞ –¶–†–õ</strong></p>
                    `
                }
            };
            
            const data = viewData[viewNum];
            title.textContent = data.title;
            subtitle.textContent = data.subtitle;
            content.innerHTML = data.content;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ badge
            badge.textContent = data.badge.text;
            badge.className = 'info-panel-badge ' + data.badge.class;
        }
        
        // ============ CONTROLS ============
        function toggleDistricts() {
            const btn = document.getElementById('toggle-districts');
            districtsVisible = !districtsVisible;
            
            if (districtsVisible) {
                createDistrictBoundaries();
                btn.classList.add('active');
            } else {
                if (districtLayer) map.removeLayer(districtLayer);
                btn.classList.remove('active');
            }
            
            showToast(districtsVisible ? '–†–∞–π–æ–Ω–∏ –ø–æ–∫–∞–∑–∞–Ω–æ' : '–†–∞–π–æ–Ω–∏ –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ');
        }
        
        function filterByNetwork(network) {
            // –ü—Ä–∏–±–∏—Ä–∞—î–º–æ active –∑ —É—Å—ñ—Ö
            document.querySelectorAll('.stat-network').forEach(el => el.classList.remove('active'));
            
            if (currentFilter === network) {
                currentFilter = null;
                createMarkers();
                showToast('–§—ñ–ª—å—Ç—Ä —Å–∫–∏–Ω—É—Ç–æ ‚Äî –ø–æ–∫–∞–∑–∞–Ω–æ –≤—Å—ñ –∑–∞–∫–ª–∞–¥–∏');
            } else {
                currentFilter = network;
                createMarkers(network);
                
                // –î–æ–¥–∞—î–º–æ active –¥–æ –≤–∏–±—Ä–∞–Ω–æ–≥–æ
                const filterMap = {
                    '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞': 'filter-nadk',
                    '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞': 'filter-klus',
                    '–ó–∞–≥–∞–ª—å–Ω–∞': 'filter-zag'
                };
                document.getElementById(filterMap[network]).classList.add('active');
                
                showToast(`–§—ñ–ª—å—Ç—Ä: —Ç—ñ–ª—å–∫–∏ ${network.toLowerCase()} –º–µ—Ä–µ–∂–∞`);
            }
        }
        
        function fitMapToAll() {
            map.setView([46.5, 29.8], 7);
            resetDistrictSelection();
            showToast('–ü–æ–≤–µ—Ä–Ω—É—Ç–æ –¥–æ –æ–≥–ª—è–¥—É –≤—Å—ñ—î—ó –æ–±–ª–∞—Å—Ç—ñ');
        }
        
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }
        
        // ============ STATISTICS ============
        function updateStats() {
            const nadk = facilities.filter(f => f.network === '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞').length;
            const klus = facilities.filter(f => f.network === '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞').length;
            const zag = facilities.filter(f => f.network === '–ó–∞–≥–∞–ª—å–Ω–∞').length;
            
            document.getElementById('stat-nadk').textContent = nadk;
            document.getElementById('stat-klus').textContent = klus;
            document.getElementById('stat-zag').textContent = zag;
            
            // –û–Ω–æ–≤–∏—Ç–∏ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ
            document.getElementById('count-nadk').textContent = nadk;
            document.getElementById('count-klus').textContent = klus;
            document.getElementById('count-zag').textContent = zag;
        }
        
        // ============ FACILITY LIST MODAL ============
        let currentModalTab = '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞';
        
        function openFacilityList() {
            document.getElementById('facility-modal').classList.add('show');
            showFacilityTab(currentModalTab);
        }
        
        function closeFacilityList(event) {
            if (!event || event.target === document.getElementById('facility-modal')) {
                document.getElementById('facility-modal').classList.remove('show');
            }
        }
        
        function showFacilityTab(network) {
            currentModalTab = network;
            
            // –û–Ω–æ–≤–∏—Ç–∏ –∞–∫—Ç–∏–≤–Ω–∏–π —Ç–∞–±
            document.querySelectorAll('.modal-tab').forEach(tab => tab.classList.remove('active'));
            const tabClass = network === '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞' ? 'nadklusterna' : 
                             network === '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞' ? 'klusterna' : 'zagalna';
            document.querySelector(`.modal-tab.${tabClass}`).classList.add('active');
            
            // –í—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ —Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–∏ –ª—ñ–∫–∞—Ä–Ω—ñ
            const filtered = facilities.filter(f => f.network === network);
            const listEl = document.getElementById('facility-list');
            
            const icons = {
                '–ù–∞–¥–∫–ª–∞—Å—Ç–µ—Ä–Ω–∞': '‚≠ê',
                '–ö–ª–∞—Å—Ç–µ—Ä–Ω–∞': 'üè•',
                '–ó–∞–≥–∞–ª—å–Ω–∞': 'üèõÔ∏è'
            };
            
            listEl.innerHTML = filtered.map(f => `
                <div class="facility-item" onclick="zoomToFacility(${f.lat}, ${f.lng}, '${f.name.replace(/'/g, "\\'")}')">
                    <div class="facility-icon ${tabClass}">${icons[network]}</div>
                    <div class="facility-info">
                        <div class="facility-name">${f.name}</div>
                        <div class="facility-district">üìç ${f.district} —Ä–∞–π–æ–Ω ‚Ä¢ ${f.type}</div>
                    </div>
                    <div class="facility-arrow">‚Üí</div>
                </div>
            `).join('');
        }
        
        function zoomToFacility(lat, lng, name) {
            closeFacilityList();
            map.setView([lat, lng], 13);
            showToast(`üìç ${name}`);
        }
        
        // ============ INIT ============
        function init() {
            createDistrictBoundaries();
            createMarkers();
            updateStats();
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∏ –ø–µ—Ä—à–æ–≥–æ —Ä–µ–∂–∏–º—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
            routesVisible = true;
            routesLayer.addTo(map);
            createRoutes();
            updateInfoPanel(1);
            
            showToast('‚úì –ö–∞—Ä—Ç—É —Å–ø—Ä–æ–º–æ–∂–Ω–æ—ó –º–µ—Ä–µ–∂—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
        }
        
        init();
    </script>
</body>
</html>
